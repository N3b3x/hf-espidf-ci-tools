

<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/hf-espidf-ci-tools/preview/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/hf-espidf-ci-tools/preview/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  

    .site-nav > ul.nav-list:first-child > li > a,
    
    .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(1)) > a,
    .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a {
      background-image: none;
    }

    .site-nav > ul.nav-list:not(:first-child) a,
    .site-nav li.external a {
      background-image: none;
    }

    .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(1) > a {
      font-weight: 600;
      text-decoration: none;
    }.site-nav > ul.nav-list:first-child > li:nth-child(2) > button svg,
    .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(1) > button svg {
      transform: rotate(-90deg);
    }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list,
    .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(1) > ul.nav-list {
      display: block;
    }
  </style>

  

  
    <script src="/hf-espidf-ci-tools/preview/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/hf-espidf-ci-tools/preview/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>ğŸ—ï¸ ESP-IDF Build Workflow Guide | hf-espidf-ci-tools - preview</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="ğŸ—ï¸ ESP-IDF Build Workflow Guide" />
<meta name="author" content="N3b3x" />
<meta property="og:locale" content="en" />
<meta name="description" content="Advanced ESP32 Build System for HardFOC Projects - Matrix-based building across multiple ESP-IDF versions, build types, and applications with intelligent caching and artifact management" />
<meta property="og:description" content="Advanced ESP32 Build System for HardFOC Projects - Matrix-based building across multiple ESP-IDF versions, build types, and applications with intelligent caching and artifact management" />
<link rel="canonical" href="https://n3b3x.github.io/hf-espidf-ci-tools/preview/docs/build-workflow/" />
<meta property="og:url" content="https://n3b3x.github.io/hf-espidf-ci-tools/preview/docs/build-workflow/" />
<meta property="og:site_name" content="hf-espidf-ci-tools - preview" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="ğŸ—ï¸ ESP-IDF Build Workflow Guide" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"N3b3x","url":"https://github.com/n3b3x"},"description":"Advanced ESP32 Build System for HardFOC Projects - Matrix-based building across multiple ESP-IDF versions, build types, and applications with intelligent caching and artifact management","headline":"ğŸ—ï¸ ESP-IDF Build Workflow Guide","url":"https://n3b3x.github.io/hf-espidf-ci-tools/preview/docs/build-workflow/"}</script>
<!-- End Jekyll SEO tag -->


  

</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  
    <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="/hf-espidf-ci-tools/preview/" class="site-title lh-tight">
  hf-espidf-ci-tools - preview

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><a href="/hf-espidf-ci-tools/preview/" class="nav-list-link">ğŸ”§ HardFOC ESP32 CI Tools</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in ğŸ“š Documentation category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/hf-espidf-ci-tools/preview/docs/" class="nav-list-link">ğŸ“š Documentation</a><ul class="nav-list"><li class="nav-list-item"><a href="/hf-espidf-ci-tools/preview/docs/build-workflow/" class="nav-list-link">ğŸ—ï¸ ESP-IDF Build Workflow Guide</a></li><li class="nav-list-item"><a href="/hf-espidf-ci-tools/preview/docs/security-workflow/" class="nav-list-link">ğŸ›¡ï¸ Security Workflow Guide</a></li><li class="nav-list-item"><a href="/hf-espidf-ci-tools/preview/docs/example-workflows/" class="nav-list-link">ğŸš€ Example Workflows for Consumer Repositories</a></li></ul></li><li class="nav-list-item"><a href="/hf-espidf-ci-tools/preview/docs/release-workflow.html" class="nav-list-link">ğŸ“¦ Release Workflow</a></li></ul>
  
</nav>




  
  
    <footer class="site-footer">
      This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.
    </footer>
  
</div>

  
  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search hf-espidf-ci-tools - preview" aria-label="Search hf-espidf-ci-tools - preview" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
    <nav aria-label="Auxiliary" class="aux-nav">
  <ul class="aux-nav-list">
    
      <li class="aux-nav-list-item">
        <a href="https://github.com/n3b3x/hf-espidf-ci-tools" class="site-button"
          
        >
          ğŸ“š GitHub Repository
        </a>
      </li>
    
      <li class="aux-nav-list-item">
        <a href="https://github.com/n3b3x/hf-espidf-ci-tools/issues" class="site-button"
          
        >
          ğŸ› Report Issues
        </a>
      </li>
    
      <li class="aux-nav-list-item">
        <a href="https://github.com/n3b3x/hf-espidf-ci-tools/stargazers" class="site-button"
          
        >
          â­ Star on GitHub
        </a>
      </li>
    
  </ul>
</nav>

  
</div>

    <div class="main-content-wrap">
      <nav aria-label="Breadcrumb" class="breadcrumb-nav">
  <ol class="breadcrumb-nav-list">
    <li class="breadcrumb-nav-list-item"><a href="/hf-espidf-ci-tools/preview/docs/">ğŸ“š Documentation</a></li>
    <li class="breadcrumb-nav-list-item"><span>ğŸ—ï¸ ESP-IDF Build Workflow Guide</span></li>
  </ol>
</nav>


      <div id="main-content" class="main-content">
        <main>
          
            <h1 id="ï¸-esp-idf-build-workflow-guide">
  
  
    <a href="#ï¸-esp-idf-build-workflow-guide" class="anchor-heading" aria-labelledby="ï¸-esp-idf-build-workflow-guide"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸ—ï¸ ESP-IDF Build Workflow Guide
  
  
</h1>
    

<p><a href="https://docs.espressif.com/projects/esp-idf/"><img src="https://img.shields.io/badge/Build-Matrix%20ESP--IDF-blue?logo=espressif" alt="Build" /></a>
<img src="https://img.shields.io/badge/CI%2FCD-GitHub%20Actions-orange?logo=github" alt="CI/CD" />
<img src="https://img.shields.io/badge/Matrix-Parallel%20Builds-green?logo=matrix" alt="Matrix" /></p>

<p><strong>ğŸš€ Advanced ESP32 Build System for HardFOC Projects</strong></p>

<p><em>Matrix-based building across multiple ESP-IDF versions, build types, and applications with intelligent caching and artifact management</em></p><hr />
<h2 id="-table-of-contents">
  
  
    <a href="#-table-of-contents" class="anchor-heading" aria-labelledby="-table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸ“‹ Table of Contents
  
  
</h2>
    

<ul>
  <li><a href="#-overview">ğŸ¯ Overview</a></li>
  <li><a href="#-inputs--configuration">âš™ï¸ Inputs &amp; Configuration</a></li>
  <li><a href="#-outputs--artifacts">ğŸ“¤ Outputs &amp; Artifacts</a></li>
  <li><a href="#-usage-examples">ğŸš€ Usage Examples</a></li>
  <li><a href="#-configuration">ğŸ”§ Configuration</a></li>
  <li><a href="#-build-process">ğŸ—ï¸ Build Process</a></li>
  <li><a href="#-troubleshooting">ğŸ” Troubleshooting</a></li>
  <li><a href="#-related-documentation">ğŸ“š Related Documentation</a></li>
</ul><hr />
<h2 id="-overview">
  
  
    <a href="#-overview" class="anchor-heading" aria-labelledby="-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸ¯ Overview
  
  
</h2>
    
<h3 id="purpose">
  
  
    <a href="#purpose" class="anchor-heading" aria-labelledby="purpose"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Purpose</strong>
  
  
</h3>
    
<p>The ESP-IDF Build workflow provides <strong>matrix-based building</strong> across multiple ESP-IDF versions, build types, and applications with intelligent caching and artifact management for HardFOC ESP32 projects.</p>
<h3 id="key-features">
  
  
    <a href="#key-features" class="anchor-heading" aria-labelledby="key-features"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Key Features</strong>
  
  
</h3>
    
<ul>
  <li>ğŸ”„ <strong>Dynamic Matrix Generation</strong> - From your projectâ€™s <code class="language-plaintext highlighter-rouge">app_config.yml</code> configuration</li>
  <li>ğŸš€ <strong>Parallel Execution</strong> - Multiple builds run simultaneously for maximum efficiency</li>
  <li>ğŸ’¾ <strong>Intelligent Caching</strong> - pip and ccache optimization for faster builds</li>
  <li>ğŸ“¦ <strong>Artifact Management</strong> - Automatic upload and organization of build outputs</li>
  <li>ğŸ›¡ï¸ <strong>ESP-IDF Environment</strong> - Official Espressif actions for reliable builds</li>
  <li>ğŸ“Š <strong>Size Reporting</strong> - Automatic PR comments with firmware size analysis</li>
  <li>ğŸ”§ <strong>Project Tools Integration</strong> - Seamless integration with HardFOC project tools</li>
  <li>ğŸ”’ <strong>Secure Tool Management</strong> - Automatic tool cloning from trusted repository with validation</li>
</ul>
<h3 id="use-cases">
  
  
    <a href="#use-cases" class="anchor-heading" aria-labelledby="use-cases"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Use Cases</strong>
  
  
</h3>
    
<ul>
  <li>âœ… <strong>CI/CD for ESP32 applications</strong> requiring multiple build configurations</li>
  <li>âœ… <strong>Multi-version testing</strong> across different ESP-IDF releases</li>
  <li>âœ… <strong>Parallel builds</strong> for faster development cycles</li>
  <li>âœ… <strong>Automated artifact management</strong> for releases and testing</li>
  <li>âœ… <strong>Size optimization tracking</strong> with PR integration</li>
</ul><hr />
<h2 id="ï¸-inputs--configuration">
  
  
    <a href="#ï¸-inputs--configuration" class="anchor-heading" aria-labelledby="ï¸-inputs--configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> âš™ï¸ Inputs &amp; Configuration
  
  
</h2>
    
<h3 id="required-inputs">
  
  
    <a href="#required-inputs" class="anchor-heading" aria-labelledby="required-inputs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Required Inputs</strong>
  
  
</h3>
    

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Input</th>
      <th>Type</th>
      <th>Required</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">project_dir</code></td>
      <td>string</td>
      <td>âœ…</td>
      <td>Path to ESP-IDF project (contains <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code>, <code class="language-plaintext highlighter-rouge">app_config.yml</code>)</td>
    </tr>
  </tbody>
</table></div>
<h3 id="optional-inputs">
  
  
    <a href="#optional-inputs" class="anchor-heading" aria-labelledby="optional-inputs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Optional Inputs</strong>
  
  
</h3>
    

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Input</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">project_tools_dir</code></td>
      <td>string</td>
      <td>Auto-detect</td>
      <td>Path to project tools directory (contains scripts directly). Leave empty to auto-detect.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">clean_build</code></td>
      <td>boolean</td>
      <td><code class="language-plaintext highlighter-rouge">false</code></td>
      <td>Skip caches for a clean build</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">auto_clone_tools</code></td>
      <td>boolean</td>
      <td><code class="language-plaintext highlighter-rouge">true</code></td>
      <td>Auto-clone tools repo if project_tools_dir is missing</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">max_dec_total</code></td>
      <td>string</td>
      <td><code class="language-plaintext highlighter-rouge">"0"</code></td>
      <td>Maximum total dec size in bytes for size budget enforcement (0 to disable)</td>
    </tr>
  </tbody>
</table></div>
<h3 id="path-configuration">
  
  
    <a href="#path-configuration" class="anchor-heading" aria-labelledby="path-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Path Configuration</strong>
  
  
</h3>
    

<p><strong>Important:</strong> All paths are resolved relative to the repository root where the workflow runs.</p>
<h3 id="secure-tool-management">
  
  
    <a href="#secure-tool-management" class="anchor-heading" aria-labelledby="secure-tool-management"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Secure Tool Management</strong>
  
  
</h3>
    

<p>The workflow includes a built-in <code class="language-plaintext highlighter-rouge">ensure-tools-directory</code> action that provides:</p>

<ul>
  <li><strong>ğŸ”’ Trusted Source Only</strong>: Only clones from the verified <code class="language-plaintext highlighter-rouge">N3b3x/hf-espidf-project-tools</code> repository</li>
  <li><strong>ğŸ›¡ï¸ Security Validation</strong>: Validates submodule URLs and ensures scripts are from trusted sources</li>
  <li><strong>âš¡ Automatic Resolution</strong>: Intelligently detects and resolves tool directory paths</li>
  <li><strong>ğŸ”§ Script Validation</strong>: Ensures all required scripts exist and are executable</li>
  <li><strong>ğŸ“ Flexible Setup</strong>: Supports submodules, direct clones, and custom tool locations</li>
  <li><strong>ğŸ”„ Multi-Project Support</strong>: Tools can be shared across multiple projects since all scripts accept <code class="language-plaintext highlighter-rouge">--project-path</code> argument</li>
</ul>
<h3 id="size-budget-enforcement">
  
  
    <a href="#size-budget-enforcement" class="anchor-heading" aria-labelledby="size-budget-enforcement"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Size Budget Enforcement</strong>
  
  
</h3>
    

<p>The workflow includes optional size budget enforcement to prevent firmware from exceeding specified limits:</p>

<ul>
  <li><strong>ğŸ“Š Automatic Size Analysis</strong>: Analyzes firmware size from all build configurations</li>
  <li><strong>ğŸš« Budget Enforcement</strong>: Fails the build if any configuration exceeds the specified limit</li>
  <li><strong>âš™ï¸ Configurable Limits</strong>: Set custom size limits via <code class="language-plaintext highlighter-rouge">max_dec_total</code> parameter</li>
  <li><strong>ğŸ” Detailed Reporting</strong>: Shows which builds exceeded limits and by how much</li>
  <li><strong>âœ… Optional Feature</strong>: Disabled by default (set to â€œ0â€), enable by setting a positive value</li>
</ul>
<h4 id="what-the-size-budget-measures">
  
  
    <a href="#what-the-size-budget-measures" class="anchor-heading" aria-labelledby="what-the-size-budget-measures"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>What the Size Budget Measures</strong>
  
  
</h4>
    

<p>The size budget is based on the <strong><code class="language-plaintext highlighter-rouge">dec</code> (decimal) size</strong> from ESP-IDFâ€™s size analysis, which represents the <strong>total memory footprint</strong> of your firmware. This includes:</p>

<ul>
  <li><strong>ğŸ“ Text Segment</strong>: Executable code, functions, and program logic</li>
  <li><strong>ğŸ“Š Data Segment</strong>: Initialized global and static variables</li>
  <li><strong>ğŸ—ƒï¸ BSS Segment</strong>: Uninitialized global and static variables (zero-initialized)</li>
</ul>

<p><strong>Size Analysis Format:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>text    data     bss     dec     hex filename
12345   6789     1234   20368   4f90 your_app.bin
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p>Where:</p>
<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">text</code></strong>: Code size (instructions, functions, constants)</li>
  <li><strong><code class="language-plaintext highlighter-rouge">data</code></strong>: Initialized variables (global/static with initial values)</li>
  <li><strong><code class="language-plaintext highlighter-rouge">bss</code></strong>: Uninitialized variables (global/static set to zero)</li>
  <li><strong><code class="language-plaintext highlighter-rouge">dec</code></strong>: <strong>Total size</strong> = text + data + bss (this is what the budget measures)</li>
  <li><strong><code class="language-plaintext highlighter-rouge">hex</code></strong>: Same as dec but in hexadecimal format</li>
</ul>

<p><strong>Why Use <code class="language-plaintext highlighter-rouge">dec</code> Size:</strong></p>
<ul>
  <li><strong>ğŸ¯ Total Memory Usage</strong>: Represents the complete RAM footprint</li>
  <li><strong>ğŸ“± Device Constraints</strong>: ESP32 devices have limited flash and RAM</li>
  <li><strong>âš–ï¸ Resource Management</strong>: Helps ensure firmware fits within device capabilities</li>
  <li><strong>ğŸ” Build Comparison</strong>: Consistent metric across different build configurations</li>
</ul>
<h4 id="common-size-budget-values">
  
  
    <a href="#common-size-budget-values" class="anchor-heading" aria-labelledby="common-size-budget-values"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Common Size Budget Values</strong>
  
  
</h4>
    

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Device</th>
      <th>Typical Budget</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>ESP32</strong></td>
      <td><code class="language-plaintext highlighter-rouge">1,600,000</code> bytes (1.6MB)</td>
      <td>Standard ESP32 with 4MB flash</td>
    </tr>
    <tr>
      <td><strong>ESP32-S2</strong></td>
      <td><code class="language-plaintext highlighter-rouge">1,600,000</code> bytes (1.6MB)</td>
      <td>ESP32-S2 with 4MB flash</td>
    </tr>
    <tr>
      <td><strong>ESP32-S3</strong></td>
      <td><code class="language-plaintext highlighter-rouge">1,600,000</code> bytes (1.6MB)</td>
      <td>ESP32-S3 with 4MB flash</td>
    </tr>
    <tr>
      <td><strong>ESP32-C3</strong></td>
      <td><code class="language-plaintext highlighter-rouge">1,600,000</code> bytes (1.6MB)</td>
      <td>ESP32-C3 with 4MB flash</td>
    </tr>
    <tr>
      <td><strong>ESP32-C6</strong></td>
      <td><code class="language-plaintext highlighter-rouge">1,600,000</code> bytes (1.6MB)</td>
      <td>ESP32-C6 with 4MB flash</td>
    </tr>
    <tr>
      <td><strong>Small Flash</strong></td>
      <td><code class="language-plaintext highlighter-rouge">800,000</code> bytes (800KB)</td>
      <td>ESP32 with 2MB flash</td>
    </tr>
    <tr>
      <td><strong>Large Flash</strong></td>
      <td><code class="language-plaintext highlighter-rouge">3,200,000</code> bytes (3.2MB)</td>
      <td>ESP32 with 8MB+ flash</td>
    </tr>
  </tbody>
</table></div>

<p><strong>Size Budget Guidelines:</strong></p>
<ul>
  <li><strong>ğŸŸ¢ Conservative</strong>: 50-60% of available flash (leaves room for OTA updates)</li>
  <li><strong>ğŸŸ¡ Moderate</strong>: 70-80% of available flash (good balance)</li>
  <li><strong>ğŸ”´ Aggressive</strong>: 90%+ of available flash (minimal room for updates)</li>
</ul>

<p><strong>Example Size Analysis:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>text    data     bss     dec     hex filename
456789  12345    8901   477035  746ab my_app.bin
</pre></td></tr></tbody></table></div></code></pre></div></div>
<ul>
  <li><strong>Total Size</strong>: 477,035 bytes (~466 KB)</li>
  <li><strong>Status</strong>: âœ… Within 1.6MB budget</li>
  <li><strong>Remaining</strong>: 1,122,965 bytes available</li>
</ul>
<h4 id="how-size-budget-enforcement-works">
  
  
    <a href="#how-size-budget-enforcement-works" class="anchor-heading" aria-labelledby="how-size-budget-enforcement-works"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>How Size Budget Enforcement Works</strong>
  
  
</h4>
    

<p>The workflow analyzes the <code class="language-plaintext highlighter-rouge">size.txt</code> files generated by ESP-IDF for each build configuration:</p>

<ol>
  <li><strong>ğŸ“Š Size Analysis</strong>: Parses the <code class="language-plaintext highlighter-rouge">dec</code> value from each <code class="language-plaintext highlighter-rouge">size.txt</code> file</li>
  <li><strong>ğŸ” Comparison</strong>: Compares each buildâ€™s size against the <code class="language-plaintext highlighter-rouge">max_dec_total</code> limit</li>
  <li><strong>âš ï¸ Violation Detection</strong>: Identifies builds that exceed the budget</li>
  <li><strong>ğŸ“ Error Reporting</strong>: Reports specific builds and their sizes</li>
  <li><strong>ğŸš« Build Failure</strong>: Fails the entire workflow if any build exceeds the limit</li>
</ol>

<p><strong>Error Example:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>::error file=build-app-gpio_test-type-Release-target-esp32c6-idf-release_v5_5/size.txt::build-app-gpio_test-type-Release-target-esp32c6-idf-release_v5_5 dec=1800000 exceeds MAX_DEC_TOTAL=1600000
::error::Size budget exceeded in 1 build(s). Check individual errors above.
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Success Example:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>âœ… All builds within size budget (1600000 bytes)
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h4 id="project-directory-project_dir">
  
  
    <a href="#project-directory-project_dir" class="anchor-heading" aria-labelledby="project-directory-project_dir"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Project Directory (<code class="language-plaintext highlighter-rouge">project_dir</code>)</strong>
  
  
</h4>
    
<ul>
  <li><strong>Purpose</strong>: Points to your ESP-IDF project directory (contains <code class="language-plaintext highlighter-rouge">CMakeLists.txt</code>, <code class="language-plaintext highlighter-rouge">app_config.yml</code>)</li>
  <li><strong>Examples</strong>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">examples/esp32</code> (most common)</li>
      <li><code class="language-plaintext highlighter-rouge">firmware/esp32-project</code></li>
      <li><code class="language-plaintext highlighter-rouge">src/esp32-app</code></li>
    </ul>
  </li>
</ul>
<h4 id="tools-directory-project_tools_dir">
  
  
    <a href="#tools-directory-project_tools_dir" class="anchor-heading" aria-labelledby="tools-directory-project_tools_dir"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Tools Directory (<code class="language-plaintext highlighter-rouge">project_tools_dir</code>)</strong>
  
  
</h4>
    
<ul>
  <li><strong>Purpose</strong>: Points to directory containing the build scripts (<code class="language-plaintext highlighter-rouge">build_app.sh</code>, <code class="language-plaintext highlighter-rouge">generate_matrix.py</code>, etc.)</li>
  <li><strong>Auto-detection</strong>: If not specified, looks for <code class="language-plaintext highlighter-rouge">hf-espidf-project-tools</code> subdirectory in project directory</li>
  <li><strong>Multi-Project Support</strong>: Can be shared across multiple projects since all scripts accept <code class="language-plaintext highlighter-rouge">--project-path</code> argument</li>
  <li><strong>Examples</strong>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">examples/esp32/scripts</code> (when using submodule)</li>
      <li><code class="language-plaintext highlighter-rouge">examples/esp32/hf-espidf-project-tools</code> (when cloned directly)</li>
      <li><code class="language-plaintext highlighter-rouge">tools/esp32-build-scripts</code> (custom location)</li>
      <li><code class="language-plaintext highlighter-rouge">shared-tools</code> (shared across multiple projects)</li>
    </ul>
  </li>
</ul>
<h4 id="common-configuration-patterns">
  
  
    <a href="#common-configuration-patterns" class="anchor-heading" aria-labelledby="common-configuration-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Common Configuration Patterns</strong>
  
  
</h4>
    

<p><strong>Pattern 1: Submodule Setup (Recommended)</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="c1"># Repository structure:</span>
<span class="c1"># your-repo/</span>
<span class="c1"># â”œâ”€â”€ examples/esp32/           # ESP-IDF project</span>
<span class="c1"># â”‚   â”œâ”€â”€ CMakeLists.txt</span>
<span class="c1"># â”‚   â”œâ”€â”€ app_config.yml</span>
<span class="c1"># â”‚   â””â”€â”€ hf-espidf-project-tools/  # Submodule containing project tools</span>
<span class="c1"># â”‚       â”œâ”€â”€ build_app.sh</span>
<span class="c1"># â”‚       â””â”€â”€ generate_matrix.py</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">project_dir</span><span class="pi">:</span> <span class="s">examples/esp32</span>
      <span class="na">project_tools_dir</span><span class="pi">:</span> <span class="s">examples/esp32/hf-espidf-project-tools</span>  <span class="c1"># Points to submodule</span>
      <span class="c1"># auto_clone_tools not needed - workflow respects explicit project_tools_dir</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>âœ… Automatic Behavior:</strong></p>
<ul>
  <li>When <code class="language-plaintext highlighter-rouge">project_tools_dir</code> is specified, the workflow uses that path directly</li>
  <li>No auto-cloning occurs when explicit path is provided</li>
  <li>Submodule detection and validation happens automatically</li>
</ul>

<p><strong>Pattern 2: Direct Clone Setup</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="c1"># Repository structure:</span>
<span class="c1"># your-repo/</span>
<span class="c1"># â”œâ”€â”€ examples/esp32/           # ESP-IDF project</span>
<span class="c1"># â”‚   â”œâ”€â”€ CMakeLists.txt</span>
<span class="c1"># â”‚   â”œâ”€â”€ app_config.yml</span>
<span class="c1"># â”‚   â””â”€â”€ hf-espidf-project-tools/  # Cloned directly</span>
<span class="c1"># â”‚       â”œâ”€â”€ build_app.sh</span>
<span class="c1"># â”‚       â””â”€â”€ generate_matrix.py</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">project_dir</span><span class="pi">:</span> <span class="s">examples/esp32</span>
      <span class="c1"># project_tools_dir not needed - auto-detects hf-espidf-project-tools</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Pattern 3: Custom Tools Location</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="c1"># Repository structure:</span>
<span class="c1"># your-repo/</span>
<span class="c1"># â”œâ”€â”€ firmware/esp32/           # ESP-IDF project</span>
<span class="c1"># â”‚   â”œâ”€â”€ CMakeLists.txt</span>
<span class="c1"># â”‚   â””â”€â”€ app_config.yml</span>
<span class="c1"># â””â”€â”€ build-tools/              # Custom tools location</span>
<span class="c1">#     â”œâ”€â”€ build_app.sh</span>
<span class="c1">#     â””â”€â”€ generate_matrix.py</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">project_dir</span><span class="pi">:</span> <span class="s">firmware/esp32</span>
      <span class="na">project_tools_dir</span><span class="pi">:</span> <span class="s">build-tools</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Pattern 4: Shared Tools for Multiple Projects</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="c1"># Repository structure:</span>
<span class="c1"># your-repo/</span>
<span class="c1"># â”œâ”€â”€ projects/</span>
<span class="c1"># â”‚   â”œâ”€â”€ project-a/            # ESP-IDF project A</span>
<span class="c1"># â”‚   â”‚   â”œâ”€â”€ CMakeLists.txt</span>
<span class="c1"># â”‚   â”‚   â””â”€â”€ app_config.yml</span>
<span class="c1"># â”‚   â””â”€â”€ project-b/            # ESP-IDF project B</span>
<span class="c1"># â”‚       â”œâ”€â”€ CMakeLists.txt</span>
<span class="c1"># â”‚       â””â”€â”€ app_config.yml</span>
<span class="c1"># â””â”€â”€ shared-tools/             # Shared tools directory</span>
<span class="c1">#     â”œâ”€â”€ build_app.sh</span>
<span class="c1">#     â””â”€â”€ generate_matrix.py</span>
<span class="c1">#</span>
<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build-project-a</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">project_dir</span><span class="pi">:</span> <span class="s">projects/project-a</span>
      <span class="na">project_tools_dir</span><span class="pi">:</span> <span class="s">shared-tools</span>  <span class="c1"># Shared across all projects</span>
      
  <span class="na">build-project-b</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">project_dir</span><span class="pi">:</span> <span class="s">projects/project-b</span>
      <span class="na">project_tools_dir</span><span class="pi">:</span> <span class="s">shared-tools</span>  <span class="c1"># Same shared tools directory</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>âœ… Why This Works:</strong></p>
<ul>
  <li>All scripts (<code class="language-plaintext highlighter-rouge">build_app.sh</code>, <code class="language-plaintext highlighter-rouge">generate_matrix.py</code>, etc.) accept <code class="language-plaintext highlighter-rouge">--project-path</code> argument</li>
  <li>The workflow automatically passes the correct project directory to each script</li>
  <li>Tools can be shared across multiple projects without duplication</li>
  <li>Each project maintains its own <code class="language-plaintext highlighter-rouge">app_config.yml</code> and build configuration</li>
</ul><hr />
<h2 id="-outputs--artifacts">
  
  
    <a href="#-outputs--artifacts" class="anchor-heading" aria-labelledby="-outputs--artifacts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸ“¤ Outputs &amp; Artifacts
  
  
</h2>
    
<h3 id="workflow-outputs">
  
  
    <a href="#workflow-outputs" class="anchor-heading" aria-labelledby="workflow-outputs"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Workflow Outputs</strong>
  
  
</h3>
    

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Output</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">matrix</code></td>
      <td>JSON matrix from <code class="language-plaintext highlighter-rouge">generate_matrix.py</code> with all build combinations</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">project_tools_path</code></td>
      <td>Resolved path to project tools directory (from generate-matrix job)</td>
    </tr>
  </tbody>
</table></div>
<h3 id="build-artifacts">
  
  
    <a href="#build-artifacts" class="anchor-heading" aria-labelledby="build-artifacts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Build Artifacts</strong>
  
  
</h3>
    

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Artifact</th>
      <th>Description</th>
      <th>Retention</th>
      <th>Location</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">fw-{app}-{version}-{build}</code></td>
      <td>Complete build directory with all outputs</td>
      <td>7 days</td>
      <td>Root artifact</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">size.txt</code></td>
      <td>Human-readable firmware size analysis</td>
      <td>7 days</td>
      <td>Inside build directory</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">size.json</code></td>
      <td>Machine-readable size data (JSON format)</td>
      <td>7 days</td>
      <td>Inside build directory</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">size.info</code></td>
      <td>Build metadata for PR reporting</td>
      <td>7 days</td>
      <td>Inside build directory</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">size.meta</code></td>
      <td>Additional metadata (ELF/MAP file paths)</td>
      <td>7 days</td>
      <td>Inside build directory</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">*.bin</code></td>
      <td>Firmware binary files</td>
      <td>7 days</td>
      <td>Inside build directory</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">*.elf</code></td>
      <td>ELF executable files</td>
      <td>7 days</td>
      <td>Inside build directory</td>
    </tr>
  </tbody>
</table></div>

<p><strong>Artifact Structure:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre>fw-gpio_test-release_v5_5-Release/
â””â”€â”€ build-app-gpio_test-type-Release-target-esp32c6-idf-release_v5_5/  # ESP-IDF build directory
    â”œâ”€â”€ size.txt                      # Size analysis
    â”œâ”€â”€ size.json                     # JSON size data
    â”œâ”€â”€ size.info                     # PR metadata
    â”œâ”€â”€ size.meta                     # Additional metadata
    â”œâ”€â”€ gpio_test.bin                 # Firmware binary
    â”œâ”€â”€ gpio_test.elf                 # ELF file
    â””â”€â”€ ...                           # Other build outputs
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Build Directory Naming:</strong>
The build directory follows the pattern: <code class="language-plaintext highlighter-rouge">build-app-{app_type}-type-{build_type}-target-{target}-idf-{idf_version}</code></p>

<p>Examples:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">build-app-gpio_test-type-Release-target-esp32c6-idf-release_v5_5</code></li>
  <li><code class="language-plaintext highlighter-rouge">build-app-adc_test-type-Debug-target-esp32c6-idf-release_v5_4</code></li>
</ul>
<h3 id="pr-integration">
  
  
    <a href="#pr-integration" class="anchor-heading" aria-labelledby="pr-integration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>PR Integration</strong>
  
  
</h3>
    

<ul>
  <li>ğŸ“Š <strong>Automatic Size Reports</strong> - PR comments with firmware size analysis</li>
  <li>ğŸ“ˆ <strong>Size Budget Enforcement</strong> - Optional size limit checking with configurable limits</li>
  <li>ğŸ” <strong>Build Status</strong> - Clear success/failure indicators</li>
  <li>âš ï¸ <strong>Budget Violations</strong> - Detailed error reporting when size limits are exceeded</li>
</ul><hr />
<h2 id="-usage-examples">
  
  
    <a href="#-usage-examples" class="anchor-heading" aria-labelledby="-usage-examples"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸš€ Usage Examples
  
  
</h2>
    
<h3 id="basic-usage">
  
  
    <a href="#basic-usage" class="anchor-heading" aria-labelledby="basic-usage"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Basic Usage</strong>
  
  
</h3>
    

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Build ESP32 Firmware</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">,</span> <span class="nv">develop</span><span class="pi">]</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">]</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">project_dir</span><span class="pi">:</span> <span class="s">examples/esp32</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="advanced-configuration">
  
  
    <a href="#advanced-configuration" class="anchor-heading" aria-labelledby="advanced-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Advanced Configuration</strong>
  
  
</h3>
    

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">Advanced ESP32 Build</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">]</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">]</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="na">clean_build</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Clean</span><span class="nv"> </span><span class="s">build</span><span class="nv"> </span><span class="s">(no</span><span class="nv"> </span><span class="s">cache)'</span>
        <span class="na">required</span><span class="pi">:</span> <span class="no">false</span>
        <span class="na">default</span><span class="pi">:</span> <span class="no">false</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">boolean</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">project_dir</span><span class="pi">:</span> <span class="s">examples/esp32</span>
      <span class="na">project_tools_dir</span><span class="pi">:</span> <span class="s">hf-espidf-project-tools</span>
      <span class="na">clean_build</span><span class="pi">:</span> <span class="s">$</span>
      <span class="na">auto_clone_tools</span><span class="pi">:</span> <span class="no">true</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="clean-build-no-caching">
  
  
    <a href="#clean-build-no-caching" class="anchor-heading" aria-labelledby="clean-build-no-caching"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Clean Build (No Caching)</strong>
  
  
</h3>
    

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">project_dir</span><span class="pi">:</span> <span class="s">examples/esp32</span>
      <span class="na">clean_build</span><span class="pi">:</span> <span class="no">true</span>  <span class="c1"># Skip all caches for fresh build</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="custom-tools-directory">
  
  
    <a href="#custom-tools-directory" class="anchor-heading" aria-labelledby="custom-tools-directory"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Custom Tools Directory</strong>
  
  
</h3>
    

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">project_dir</span><span class="pi">:</span> <span class="s">examples/esp32</span>
      <span class="na">project_tools_dir</span><span class="pi">:</span> <span class="s">custom-tools</span>  <span class="c1"># Use custom tools directory</span>
      <span class="na">auto_clone_tools</span><span class="pi">:</span> <span class="no">false</span>  <span class="c1"># Don't auto-clone, use existing</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="size-budget-enforcement-1">
  
  
    <a href="#size-budget-enforcement-1" class="anchor-heading" aria-labelledby="size-budget-enforcement-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Size Budget Enforcement</strong>
  
  
</h3>
    

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">project_dir</span><span class="pi">:</span> <span class="s">examples/esp32</span>
      <span class="na">max_dec_total</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1600000"</span>  <span class="c1"># 1.6MB size limit (in bytes)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="advanced-configuration-with-size-budget">
  
  
    <a href="#advanced-configuration-with-size-budget" class="anchor-heading" aria-labelledby="advanced-configuration-with-size-budget"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Advanced Configuration with Size Budget</strong>
  
  
</h3>
    

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="na">name</span><span class="pi">:</span> <span class="s">ESP32 Build with Size Budget</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">push</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">]</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">branches</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">main</span><span class="pi">]</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>
    <span class="na">inputs</span><span class="pi">:</span>
      <span class="na">size_limit</span><span class="pi">:</span>
        <span class="na">description</span><span class="pi">:</span> <span class="s1">'</span><span class="s">Size</span><span class="nv"> </span><span class="s">limit</span><span class="nv"> </span><span class="s">in</span><span class="nv"> </span><span class="s">MB'</span>
        <span class="na">required</span><span class="pi">:</span> <span class="no">false</span>
        <span class="na">default</span><span class="pi">:</span> <span class="s1">'</span><span class="s">1.6'</span>
        <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">project_dir</span><span class="pi">:</span> <span class="s">examples/esp32</span>
      <span class="na">project_tools_dir</span><span class="pi">:</span> <span class="s">hf-espidf-project-tools</span>
      <span class="na">clean_build</span><span class="pi">:</span> <span class="no">false</span>
      <span class="na">max_dec_total</span><span class="pi">:</span> <span class="s">${{ github.event.inputs.size_limit != '' &amp;&amp; format('{0}{1}', github.event.inputs.size_limit, '000000') || '1600000' }}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="-configuration">
  
  
    <a href="#-configuration" class="anchor-heading" aria-labelledby="-configuration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸ”§ Configuration
  
  
</h2>
    
<h3 id="project-structure-requirements">
  
  
    <a href="#project-structure-requirements" class="anchor-heading" aria-labelledby="project-structure-requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Project Structure Requirements</strong>
  
  
</h3>
    

<p>Your ESP32 project must have this structure:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre>your-project/
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ esp32/                    # ESP-IDF project directory
â”‚       â”œâ”€â”€ CMakeLists.txt        # Project-level CMakeLists.txt
â”‚       â”œâ”€â”€ app_config.yml        # Build configuration
â”‚       â”œâ”€â”€ main/                 # Application source code
â”‚       â”‚   â”œâ”€â”€ AppTest1.cpp      # An independent application that we can build target for
â”‚       â”‚   â”œâ”€â”€ AppTest2.cpp      # An independent application that we can build target for
â”‚       â”‚   â””â”€â”€ CMakeLists.txt    # Component-level CMakeLists.txt
â”‚       â”œâ”€â”€ components/           # Custom components
â”‚       â””â”€â”€ hf-espidf-project-tools/  # Project tools (submodule)
â”‚           â”œâ”€â”€ generate_matrix.py    # Matrix generator
â”‚           â”œâ”€â”€ build_app.sh          # Application builder
â”‚           â”œâ”€â”€ config_loader.sh      # Configuration loader
â”‚           â””â”€â”€ requirements.txt      # Python dependencies
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="how-the-ci-system-works-with-app_configyml">
  
  
    <a href="#how-the-ci-system-works-with-app_configyml" class="anchor-heading" aria-labelledby="how-the-ci-system-works-with-app_configyml"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>How the CI System Works with app_config.yml</strong>
  
  
</h3>
    

<p>The CI scripts are designed to capitalize on the <code class="language-plaintext highlighter-rouge">app_config.yml</code> configuration and the <code class="language-plaintext highlighter-rouge">hf-espidf-project-tools</code> submodule to enable <strong>parallel building</strong> of multiple applications. Hereâ€™s how it works:</p>
<h4 id="1-configuration-driven-matrix-generation">
  
  
    <a href="#1-configuration-driven-matrix-generation" class="anchor-heading" aria-labelledby="1-configuration-driven-matrix-generation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>1. Configuration-Driven Matrix Generation</strong>
  
  
</h4>
    

<p>The <code class="language-plaintext highlighter-rouge">app_config.yml</code> file defines all available applications and their build configurations:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="c1"># app_config.yml example</span>
<span class="na">version</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1.0"</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">project</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ESP32</span><span class="nv"> </span><span class="s">HardFOC</span><span class="nv"> </span><span class="s">Interface</span><span class="nv"> </span><span class="s">Wrapper"</span>
  <span class="na">default_app</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ascii_art"</span>
  <span class="na">target</span><span class="pi">:</span> <span class="s2">"</span><span class="s">esp32c6"</span>
  <span class="na">idf_versions</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">release/v5.5"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">release/v5.4"</span><span class="pi">]</span>
  <span class="na">build_types</span><span class="pi">:</span> <span class="pi">[[</span><span class="s2">"</span><span class="s">Debug"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">Release"</span><span class="pi">],</span> <span class="pi">[</span><span class="s2">"</span><span class="s">Debug"</span><span class="pi">]]</span>

<span class="na">apps</span><span class="pi">:</span>
  <span class="na">ascii_art</span><span class="pi">:</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ASCII</span><span class="nv"> </span><span class="s">art</span><span class="nv"> </span><span class="s">generator</span><span class="nv"> </span><span class="s">example"</span>
    <span class="na">source_file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AsciiArtComprehensiveTest.cpp"</span>
    <span class="na">category</span><span class="pi">:</span> <span class="s2">"</span><span class="s">utility"</span>
    <span class="na">idf_versions</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">release/v5.5"</span><span class="pi">]</span>
    <span class="na">build_types</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">Debug"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">Release"</span><span class="pi">]</span>
    <span class="na">ci_enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">featured</span><span class="pi">:</span> <span class="no">true</span>

  <span class="na">gpio_test</span><span class="pi">:</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">GPIO</span><span class="nv"> </span><span class="s">peripheral</span><span class="nv"> </span><span class="s">comprehensive</span><span class="nv"> </span><span class="s">testing"</span>
    <span class="na">source_file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">GpioComprehensiveTest.cpp"</span>
    <span class="na">category</span><span class="pi">:</span> <span class="s2">"</span><span class="s">peripheral"</span>
    <span class="na">idf_versions</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">release/v5.5"</span><span class="pi">]</span>
    <span class="na">build_types</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">Debug"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">Release"</span><span class="pi">]</span>
    <span class="na">ci_enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">featured</span><span class="pi">:</span> <span class="no">true</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h4 id="2-dynamic-matrix-generation">
  
  
    <a href="#2-dynamic-matrix-generation" class="anchor-heading" aria-labelledby="2-dynamic-matrix-generation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>2. Dynamic Matrix Generation</strong>
  
  
</h4>
    

<p>The <code class="language-plaintext highlighter-rouge">generate_matrix.py</code> script reads <code class="language-plaintext highlighter-rouge">app_config.yml</code> and creates a build matrix:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="c1"># Generated matrix example
</span><span class="p">{</span>
  <span class="s">"include"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s">"idf_version"</span><span class="p">:</span> <span class="s">"release/v5.5"</span><span class="p">,</span>
      <span class="s">"idf_version_docker"</span><span class="p">:</span> <span class="s">"v5.5"</span><span class="p">,</span>
      <span class="s">"idf_version_file"</span><span class="p">:</span> <span class="s">"release_v5_5"</span><span class="p">,</span>
      <span class="s">"build_type"</span><span class="p">:</span> <span class="s">"Debug"</span><span class="p">,</span>
      <span class="s">"app_name"</span><span class="p">:</span> <span class="s">"ascii_art"</span><span class="p">,</span>
      <span class="s">"target"</span><span class="p">:</span> <span class="s">"esp32c6"</span><span class="p">,</span>
      <span class="s">"config_source"</span><span class="p">:</span> <span class="s">"app"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"idf_version"</span><span class="p">:</span> <span class="s">"release/v5.5"</span><span class="p">,</span>
      <span class="s">"idf_version_docker"</span><span class="p">:</span> <span class="s">"v5.5"</span><span class="p">,</span> 
      <span class="s">"idf_version_file"</span><span class="p">:</span> <span class="s">"release_v5_5"</span><span class="p">,</span>
      <span class="s">"build_type"</span><span class="p">:</span> <span class="s">"Release"</span><span class="p">,</span>
      <span class="s">"app_name"</span><span class="p">:</span> <span class="s">"ascii_art"</span><span class="p">,</span>
      <span class="s">"target"</span><span class="p">:</span> <span class="s">"esp32c6"</span><span class="p">,</span>
      <span class="s">"config_source"</span><span class="p">:</span> <span class="s">"app"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"idf_version"</span><span class="p">:</span> <span class="s">"release/v5.5"</span><span class="p">,</span>
      <span class="s">"idf_version_docker"</span><span class="p">:</span> <span class="s">"v5.5"</span><span class="p">,</span>
      <span class="s">"idf_version_file"</span><span class="p">:</span> <span class="s">"release_v5_5"</span><span class="p">,</span> 
      <span class="s">"build_type"</span><span class="p">:</span> <span class="s">"Debug"</span><span class="p">,</span>
      <span class="s">"app_name"</span><span class="p">:</span> <span class="s">"gpio_test"</span><span class="p">,</span>
      <span class="s">"target"</span><span class="p">:</span> <span class="s">"esp32c6"</span><span class="p">,</span>
      <span class="s">"config_source"</span><span class="p">:</span> <span class="s">"app"</span>
    <span class="p">}</span>
    <span class="o">//</span> <span class="p">...</span> <span class="n">more</span> <span class="n">combinations</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h4 id="3-two-level-cmakeliststxt-structure">
  
  
    <a href="#3-two-level-cmakeliststxt-structure" class="anchor-heading" aria-labelledby="3-two-level-cmakeliststxt-structure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>3. Two-Level CMakeLists.txt Structure</strong>
  
  
</h4>
    

<p>The system uses a <strong>two-level CMakeLists.txt structure</strong> to enable dynamic app type selection:</p>

<p><strong>Level 1: Project-Level CMakeLists.txt</strong> (in project root)</p>
<ul>
  <li>Sets up global variables (<code class="language-plaintext highlighter-rouge">APP_TYPE</code>, <code class="language-plaintext highlighter-rouge">BUILD_TYPE</code>)</li>
  <li>Validates app types against <code class="language-plaintext highlighter-rouge">app_config.yml</code></li>
  <li>Includes ESP-IDF build system</li>
  <li>Sets project name dynamically</li>
</ul>

<p><strong>Level 2: Component-Level CMakeLists.txt</strong> (in main/ folder)</p>
<ul>
  <li>Gets source file from <code class="language-plaintext highlighter-rouge">app_config.yml</code> based on <code class="language-plaintext highlighter-rouge">APP_TYPE</code></li>
  <li>Registers component with dynamic source file</li>
  <li>Sets up include paths and compile definitions</li>
  <li>Handles build type-specific compiler flags</li>
</ul>

<p><strong>Project-Level CMakeLists.txt</strong> (in project root):</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="rouge-code"><pre><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.16<span class="p">)</span>

<span class="c1"># CRITICAL: Set variables BEFORE any other processing</span>
<span class="c1"># This ensures they are available during component configuration</span>
<span class="nb">if</span><span class="p">(</span>DEFINED APP_TYPE<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"APP_TYPE from command line: </span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">else</span><span class="p">()</span>
    <span class="nb">set</span><span class="p">(</span>APP_TYPE <span class="s2">"ascii_art"</span><span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"APP_TYPE defaulting to: </span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="nb">if</span><span class="p">(</span>DEFINED BUILD_TYPE<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"BUILD_TYPE from command line: </span><span class="si">${</span><span class="nv">BUILD_TYPE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">else</span><span class="p">()</span>
    <span class="nb">set</span><span class="p">(</span>BUILD_TYPE <span class="s2">"Release"</span><span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"BUILD_TYPE defaulting to: </span><span class="si">${</span><span class="nv">BUILD_TYPE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Validate app type by reading from app_config.yml (single source of truth)</span>
<span class="nb">execute_process</span><span class="p">(</span>
    COMMAND python3 <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/scripts/get_app_info.py"</span> list
    OUTPUT_VARIABLE VALID_APP_TYPES_STRING
    OUTPUT_STRIP_TRAILING_WHITESPACE
    RESULT_VARIABLE APP_LIST_RESULT
    WORKING_DIRECTORY <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">"</span>
<span class="p">)</span>

<span class="nb">if</span><span class="p">(</span>NOT APP_LIST_RESULT EQUAL 0<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Failed to read valid app types from app_config.yml"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Convert space-separated string to CMake list</span>
<span class="nb">string</span><span class="p">(</span>REPLACE <span class="s2">" "</span> <span class="s2">";"</span> VALID_APP_TYPES <span class="s2">"</span><span class="si">${</span><span class="nv">VALID_APP_TYPES_STRING</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">if</span><span class="p">(</span>NOT APP_TYPE IN_LIST VALID_APP_TYPES<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Invalid APP_TYPE: </span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">. Valid types: </span><span class="si">${</span><span class="nv">VALID_APP_TYPES</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Validate build type</span>
<span class="nb">set</span><span class="p">(</span>VALID_BUILD_TYPES <span class="s2">"Debug;Release"</span><span class="p">)</span>
<span class="nb">if</span><span class="p">(</span>NOT BUILD_TYPE IN_LIST VALID_BUILD_TYPES<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Invalid BUILD_TYPE: </span><span class="si">${</span><span class="nv">BUILD_TYPE</span><span class="si">}</span><span class="s2">. Valid types: </span><span class="si">${</span><span class="nv">VALID_BUILD_TYPES</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># CRITICAL: Set these as global variables for all components</span>
<span class="nb">set</span><span class="p">(</span>APP_TYPE <span class="s2">"</span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">"</span> CACHE STRING <span class="s2">"App type to build"</span> FORCE<span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>BUILD_TYPE <span class="s2">"</span><span class="si">${</span><span class="nv">BUILD_TYPE</span><span class="si">}</span><span class="s2">"</span> CACHE STRING <span class="s2">"Build type (Debug/Release)"</span> FORCE<span class="p">)</span>

<span class="c1"># Include ESP-IDF build system</span>
<span class="nb">include</span><span class="p">(</span>$ENV{IDF_PATH}/tools/cmake/project.cmake<span class="p">)</span>

<span class="c1"># Set project name based on app type</span>
<span class="nb">project</span><span class="p">(</span>esp32_iid_<span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span>_app<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Component-Level CMakeLists.txt</strong> (in main/ folder):</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre></td><td class="rouge-code"><pre><span class="c1"># Flexible main component for different app types</span>
<span class="c1"># Determine source file based on APP_TYPE</span>

<span class="c1"># Get app type from parent (set by project-level CMakeLists.txt)</span>
<span class="nb">if</span><span class="p">(</span>NOT DEFINED APP_TYPE<span class="p">)</span>
    <span class="nb">set</span><span class="p">(</span>APP_TYPE <span class="s2">"main"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Get source file from centralized configuration</span>
<span class="nb">execute_process</span><span class="p">(</span>
    COMMAND python3 <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/../scripts/get_app_info.py"</span> validate <span class="s2">"</span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">"</span>
    RESULT_VARIABLE VALIDATE_RESULT
    OUTPUT_QUIET
    ERROR_QUIET
<span class="p">)</span>

<span class="nb">if</span><span class="p">(</span>NOT VALIDATE_RESULT EQUAL 0<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Unknown APP_TYPE: </span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="nb">execute_process</span><span class="p">(</span>
    COMMAND python3 <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/../scripts/get_app_info.py"</span> source_file <span class="s2">"</span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">"</span>
    OUTPUT_VARIABLE MAIN_SOURCE
    OUTPUT_STRIP_TRAILING_WHITESPACE
    RESULT_VARIABLE SOURCE_RESULT
<span class="p">)</span>

<span class="nb">if</span><span class="p">(</span>NOT SOURCE_RESULT EQUAL 0<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Failed to get source file for APP_TYPE: </span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Check if source file exists and handle path resolution</span>
<span class="nb">set</span><span class="p">(</span>SOURCE_FILE_PATH <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">MAIN_SOURCE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">if</span><span class="p">(</span>NOT EXISTS <span class="s2">"</span><span class="si">${</span><span class="nv">SOURCE_FILE_PATH</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">set</span><span class="p">(</span>SOURCE_FILE_PATH <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_LIST_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">MAIN_SOURCE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">if</span><span class="p">(</span>NOT EXISTS <span class="s2">"</span><span class="si">${</span><span class="nv">SOURCE_FILE_PATH</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Source file not found: </span><span class="si">${</span><span class="nv">MAIN_SOURCE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">endif</span><span class="p">()</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Determine include paths based on environment</span>
<span class="nb">if</span><span class="p">(</span>EXISTS <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/../inc"</span><span class="p">)</span>
    <span class="nb">set</span><span class="p">(</span>INC_BASE_PATH <span class="s2">"../inc"</span><span class="p">)</span>
<span class="nb">elseif</span><span class="p">(</span>EXISTS <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/../../../inc"</span><span class="p">)</span>
    <span class="nb">set</span><span class="p">(</span>INC_BASE_PATH <span class="s2">"../../../inc"</span><span class="p">)</span>
<span class="nb">else</span><span class="p">()</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Cannot find inc directory"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Register component with dynamic source file</span>
<span class="nf">idf_component_register</span><span class="p">(</span>
    SRCS <span class="s2">"</span><span class="si">${</span><span class="nv">MAIN_SOURCE</span><span class="si">}</span><span class="s2">"</span>
    INCLUDE_DIRS <span class="s2">"."</span> <span class="s2">"</span><span class="si">${</span><span class="nv">INC_BASE_PATH</span><span class="si">}</span><span class="s2">"</span> <span class="s2">"</span><span class="si">${</span><span class="nv">INC_BASE_PATH</span><span class="si">}</span><span class="s2">/base"</span> <span class="s2">"</span><span class="si">${</span><span class="nv">INC_BASE_PATH</span><span class="si">}</span><span class="s2">/mcu/esp32"</span>
    REQUIRES driver esp_timer freertos iid-espidf
<span class="p">)</span>

<span class="c1"># Set C++ standard</span>
<span class="nb">target_compile_features</span><span class="p">(</span><span class="si">${</span><span class="nv">COMPONENT_LIB</span><span class="si">}</span> PRIVATE cxx_std_17<span class="p">)</span>

<span class="c1"># Set compiler flags based on build type</span>
<span class="nb">if</span><span class="p">(</span>BUILD_TYPE STREQUAL <span class="s2">"Debug"</span><span class="p">)</span>
    <span class="nb">target_compile_options</span><span class="p">(</span><span class="si">${</span><span class="nv">COMPONENT_LIB</span><span class="si">}</span> PRIVATE
        -Wall -Wextra -Wpedantic -O0 -g3 -DDEBUG
    <span class="p">)</span>
<span class="nb">else</span><span class="p">()</span>
    <span class="nb">target_compile_options</span><span class="p">(</span><span class="si">${</span><span class="nv">COMPONENT_LIB</span><span class="si">}</span> PRIVATE
        -Wall -Wextra -Wpedantic -O2 -g -DNDEBUG
    <span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Add compile definitions for each example type</span>
<span class="nb">target_compile_definitions</span><span class="p">(</span><span class="si">${</span><span class="nv">COMPONENT_LIB</span><span class="si">}</span> PRIVATE 
    <span class="s2">"EXAMPLE_TYPE_</span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">=1"</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h4 id="4-parallel-build-execution">
  
  
    <a href="#4-parallel-build-execution" class="anchor-heading" aria-labelledby="4-parallel-build-execution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>4. Parallel Build Execution</strong>
  
  
</h4>
    

<p>The CI workflow executes each matrix combination in parallel:</p>

<ol>
  <li><strong>Matrix Generation</strong>: Creates build combinations from <code class="language-plaintext highlighter-rouge">app_config.yml</code></li>
  <li><strong>Parallel Jobs</strong>: Each combination runs as a separate GitHub Actions job</li>
  <li><strong>Dynamic Building</strong>: Each job builds a specific app with specific settings</li>
  <li><strong>Artifact Collection</strong>: All builds are collected and organized</li>
</ol>
<h4 id="5-key-benefits-of-this-approach">
  
  
    <a href="#5-key-benefits-of-this-approach" class="anchor-heading" aria-labelledby="5-key-benefits-of-this-approach"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>5. Key Benefits of This Approach</strong>
  
  
</h4>
    

<ul>
  <li><strong>ğŸ”„ Parallel Execution</strong>: Multiple apps build simultaneously</li>
  <li><strong>âš™ï¸ Configuration-Driven</strong>: All settings centralized in <code class="language-plaintext highlighter-rouge">app_config.yml</code></li>
  <li><strong>ğŸ¯ Flexible</strong>: Easy to add/remove apps or build configurations</li>
  <li><strong>ğŸ”§ Maintainable</strong>: Single source of truth for all build settings</li>
  <li><strong>ğŸ“Š Comprehensive</strong>: Tests all combinations automatically</li>
  <li><strong>ğŸš€ Scalable</strong>: Can handle dozens of apps and configurations</li>
</ul>
<h4 id="6-cmakeliststxt-requirements">
  
  
    <a href="#6-cmakeliststxt-requirements" class="anchor-heading" aria-labelledby="6-cmakeliststxt-requirements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>6. CMakeLists.txt Requirements</strong>
  
  
</h4>
    

<p>The CMakeLists.txt setup depends on your build approach. There are two main scenarios:</p>

<p><strong>Scenario A: CI-Only Builds (Minimal Setup)</strong></p>
<ul>
  <li>Uses <code class="language-plaintext highlighter-rouge">build_app.sh</code> script which handles all the complexity</li>
  <li>CMakeLists.txt can be minimal since the script manages everything</li>
  <li>No direct <code class="language-plaintext highlighter-rouge">idf.py</code> support needed</li>
</ul>

<p><strong>Scenario B: Full <code class="language-plaintext highlighter-rouge">idf.py</code> Compatibility (Complete Setup)</strong></p>
<ul>
  <li>Supports both CI builds and direct <code class="language-plaintext highlighter-rouge">idf.py</code> usage</li>
  <li>Requires more complex CMakeLists.txt setup</li>
  <li>Enables development workflow with <code class="language-plaintext highlighter-rouge">idf.py build -DAPP_TYPE=app_name</code></li>
</ul>

<p>Let me show both approaches:</p>

<p><strong>Scenario A: Minimal CMakeLists.txt (CI-Only Builds)</strong></p>

<p>If you only use <code class="language-plaintext highlighter-rouge">build_app.sh</code> for building (CI workflows), your CMakeLists.txt can be minimal:</p>

<p><strong>Project-Level CMakeLists.txt</strong> (minimal):</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.16<span class="p">)</span>

<span class="c1"># Define APP_TYPE with default value</span>
<span class="nb">if</span><span class="p">(</span>NOT DEFINED APP_TYPE<span class="p">)</span>
    <span class="nb">set</span><span class="p">(</span>APP_TYPE <span class="s2">"main"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="nb">include</span><span class="p">(</span>$ENV{IDF_PATH}/tools/cmake/project.cmake<span class="p">)</span>
<span class="nb">project</span><span class="p">(</span>esp32_iid_<span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span>_app<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Component-Level CMakeLists.txt</strong> (ultra-minimal):</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c1"># Ultra-minimal setup - build_app.sh handles source file discovery</span>
<span class="c1"># Get source file from environment variable set by build_app.sh</span>
<span class="nb">if</span><span class="p">(</span>NOT DEFINED APP_SOURCE_FILE<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"APP_SOURCE_FILE not defined. Use build_app.sh to build."</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Register component with source file from build_app.sh</span>
<span class="nf">idf_component_register</span><span class="p">(</span>
    SRCS <span class="s2">"</span><span class="si">${</span><span class="nv">APP_SOURCE_FILE</span><span class="si">}</span><span class="s2">"</span>  <span class="c1"># Source file from build_app.sh</span>
    INCLUDE_DIRS <span class="s2">"."</span>  <span class="c1"># Add your own include directories as needed</span>
    REQUIRES driver esp_timer freertos  <span class="c1"># Add your own requirements as needed</span>
<span class="p">)</span>

<span class="c1"># Add compile definitions for each example type</span>
<span class="nb">target_compile_definitions</span><span class="p">(</span><span class="si">${</span><span class="nv">COMPONENT_LIB</span><span class="si">}</span> PRIVATE 
    <span class="s2">"EXAMPLE_TYPE_</span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">=1"</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Note for Users:</strong></p>
<ul>
  <li><strong>INCLUDE_DIRS</strong>: Add your own include directories (e.g., <code class="language-plaintext highlighter-rouge">"../inc"</code>, <code class="language-plaintext highlighter-rouge">"../lib"</code>)</li>
  <li><strong>REQUIRES</strong>: Add your own component requirements (e.g., <code class="language-plaintext highlighter-rouge">"your_component"</code>, <code class="language-plaintext highlighter-rouge">"esp_wifi"</code>)</li>
  <li><strong>SRCS</strong>: Only <code class="language-plaintext highlighter-rouge">APP_SOURCE_FILE</code> is required - the script handles source file selection</li>
  <li><strong>APP_TYPE</strong>: Only <code class="language-plaintext highlighter-rouge">APP_TYPE</code> is required - the script handles app type validation</li>
</ul>

<p><strong>What Gets Removed in Ultra-Minimal Setup:</strong></p>
<ul>
  <li>âŒ <strong>App Type Validation</strong>: No checking if <code class="language-plaintext highlighter-rouge">APP_TYPE</code> exists in <code class="language-plaintext highlighter-rouge">app_config.yml</code></li>
  <li>âŒ <strong>Build Type Validation</strong>: No checking if <code class="language-plaintext highlighter-rouge">BUILD_TYPE</code> is valid</li>
  <li>âŒ <strong>Advanced Variable Setting</strong>: No <code class="language-plaintext highlighter-rouge">set(APP_TYPE ... CACHE ... FORCE)</code> or <code class="language-plaintext highlighter-rouge">set(BUILD_TYPE ...)</code></li>
  <li>âŒ <strong>Dynamic Project Naming</strong>: No <code class="language-plaintext highlighter-rouge">project(esp32_iid_${APP_TYPE}_app)</code></li>
  <li>âŒ <strong>Python Dependencies</strong>: No <code class="language-plaintext highlighter-rouge">execute_process</code> calls to <code class="language-plaintext highlighter-rouge">get_app_info.py</code></li>
  <li>âŒ <strong>Source File Discovery</strong>: No dynamic source file selection in CMake</li>
</ul>

<p><strong>What Stays in Ultra-Minimal Setup:</strong></p>
<ul>
  <li>âœ… <strong>Basic APP_TYPE Definition</strong>: Simple <code class="language-plaintext highlighter-rouge">if(NOT DEFINED APP_TYPE)</code> with default</li>
  <li>âœ… <strong>Dynamic Project Naming</strong>: Still uses <code class="language-plaintext highlighter-rouge">project(esp32_iid_${APP_TYPE}_app)</code></li>
  <li>âœ… <strong>Environment Variable Usage</strong>: Uses <code class="language-plaintext highlighter-rouge">APP_SOURCE_FILE</code> from <code class="language-plaintext highlighter-rouge">build_app.sh</code></li>
  <li>âœ… <strong>APP_TYPE Variable</strong>: Still receives <code class="language-plaintext highlighter-rouge">APP_TYPE</code> from <code class="language-plaintext highlighter-rouge">build_app.sh</code></li>
  <li>âœ… <strong>Compile Definitions</strong>: Still adds <code class="language-plaintext highlighter-rouge">EXAMPLE_TYPE_${APP_TYPE}=1</code></li>
  <li>âœ… <strong>Basic Component Registration</strong>: Registers component with source from script</li>
</ul>

<p><strong>Why This Works:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">build_app.sh</code> discovers source file from <code class="language-plaintext highlighter-rouge">app_config.yml</code> and sets <code class="language-plaintext highlighter-rouge">APP_SOURCE_FILE</code> environment variable</li>
  <li><code class="language-plaintext highlighter-rouge">build_app.sh</code> calls <code class="language-plaintext highlighter-rouge">idf.py</code> with <code class="language-plaintext highlighter-rouge">-D APP_TYPE=app_name</code>, <code class="language-plaintext highlighter-rouge">-D APP_SOURCE_FILE=source_file</code>, and <code class="language-plaintext highlighter-rouge">-D BUILD_TYPE=build_type</code></li>
  <li>CMakeLists.txt simply uses the <code class="language-plaintext highlighter-rouge">APP_SOURCE_FILE</code> variable provided by the script</li>
  <li><code class="language-plaintext highlighter-rouge">build_app.sh</code> handles all validation and source file discovery before calling <code class="language-plaintext highlighter-rouge">idf.py</code></li>
  <li>Perfect for CI-only workflows where script handles everything</li>
</ul>

<p><strong>Alternative Minimal Approach (Conditional Sources):</strong></p>

<p>You can also use CMakeâ€™s conditional source inclusion instead of dynamic source selection:</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="c1"># Alternative minimal approach using conditional sources</span>
<span class="nf">idf_component_register</span><span class="p">(</span>
    SRCS
        <span class="s2">"common_source.cpp"</span>
        $&lt;$&lt;STREQUAL:<span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span>,ascii_art&gt;:<span class="s2">"AsciiArtComprehensiveTest.cpp"</span>&gt;
        $&lt;$&lt;STREQUAL:<span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span>,gpio_test&gt;:<span class="s2">"GpioComprehensiveTest.cpp"</span>&gt;
        $&lt;$&lt;STREQUAL:<span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span>,adc_test&gt;:<span class="s2">"AdcComprehensiveTest.cpp"</span>&gt;
        $&lt;$&lt;STREQUAL:<span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span>,uart_test&gt;:<span class="s2">"UartComprehensiveTest.cpp"</span>&gt;
    INCLUDE_DIRS <span class="s2">"."</span>
    REQUIRES driver esp_timer freertos
<span class="p">)</span>

<span class="c1"># Add compile definitions for each example type</span>
<span class="nb">target_compile_definitions</span><span class="p">(</span><span class="si">${</span><span class="nv">COMPONENT_LIB</span><span class="si">}</span> PRIVATE 
    <span class="s2">"EXAMPLE_TYPE_</span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">=1"</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Pros of Conditional Sources:</strong></p>
<ul>
  <li>âœ… <strong>No Python Dependencies</strong>: Doesnâ€™t need <code class="language-plaintext highlighter-rouge">get_app_info.py</code></li>
  <li>âœ… <strong>Faster CMake</strong>: No <code class="language-plaintext highlighter-rouge">execute_process</code> calls</li>
  <li>âœ… <strong>Explicit</strong>: All source files are visible in CMakeLists.txt</li>
</ul>

<p><strong>Cons of Conditional Sources:</strong></p>
<ul>
  <li>âŒ <strong>Manual Maintenance</strong>: Must update CMakeLists.txt when adding new apps</li>
  <li>âŒ <strong>Not DRY</strong>: Duplicates information from <code class="language-plaintext highlighter-rouge">app_config.yml</code></li>
  <li>âŒ <strong>Error Prone</strong>: Easy to forget to add new apps</li>
</ul>

<p><strong>Ultra-Minimal CMakeLists.txt</strong> (no Python dependencies):</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.16<span class="p">)</span>

<span class="c1"># Define APP_TYPE with default value</span>
<span class="nb">if</span><span class="p">(</span>NOT DEFINED APP_TYPE<span class="p">)</span>
    <span class="nb">set</span><span class="p">(</span>APP_TYPE <span class="s2">"main"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="nb">include</span><span class="p">(</span>$ENV{IDF_PATH}/tools/cmake/project.cmake<span class="p">)</span>
<span class="nb">project</span><span class="p">(</span>esp32_app<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Ultra-Minimal Component CMakeLists.txt</strong> (no Python dependencies):</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="c1"># Get source file from environment variable set by build_app.sh</span>
<span class="nb">if</span><span class="p">(</span>DEFINED ENV{APP_SOURCE_FILE}<span class="p">)</span>
    <span class="nb">set</span><span class="p">(</span>MAIN_SOURCE $ENV{APP_SOURCE_FILE}<span class="p">)</span>
<span class="nb">else</span><span class="p">()</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"APP_SOURCE_FILE environment variable not set. Run build_app.sh instead of idf.py directly."</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Register component with source file from environment</span>
<span class="nf">idf_component_register</span><span class="p">(</span>
    SRCS <span class="s2">"</span><span class="si">${</span><span class="nv">MAIN_SOURCE</span><span class="si">}</span><span class="s2">"</span>
    INCLUDE_DIRS <span class="s2">"."</span>
    REQUIRES driver esp_timer freertos
<span class="p">)</span>

<span class="c1"># Add compile definitions for each example type</span>
<span class="nb">target_compile_definitions</span><span class="p">(</span><span class="si">${</span><span class="nv">COMPONENT_LIB</span><span class="si">}</span> PRIVATE 
    <span class="s2">"EXAMPLE_TYPE_</span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">=1"</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Pros of Environment Variable Approach:</strong></p>
<ul>
  <li>âœ… <strong>No Python Dependencies in CMake</strong>: CMakeLists.txt is completely Python-free</li>
  <li>âœ… <strong>Faster CMake</strong>: No <code class="language-plaintext highlighter-rouge">execute_process</code> calls during CMake configuration</li>
  <li>âœ… <strong>Centralized Logic</strong>: All app selection logic in <code class="language-plaintext highlighter-rouge">build_app.sh</code></li>
  <li>âœ… <strong>Clear Separation</strong>: Script handles configuration, CMake handles building</li>
  <li>âœ… <strong>Error Prevention</strong>: Prevents direct <code class="language-plaintext highlighter-rouge">idf.py</code> usage without proper setup</li>
</ul>

<p><strong>Cons of Environment Variable Approach:</strong></p>
<ul>
  <li>âŒ <strong>No Direct <code class="language-plaintext highlighter-rouge">idf.py</code> Support</strong>: Must always use <code class="language-plaintext highlighter-rouge">build_app.sh</code></li>
  <li>âŒ <strong>Environment Dependency</strong>: Relies on environment variables being set</li>
  <li>âŒ <strong>Script Coupling</strong>: CMakeLists.txt is tightly coupled to <code class="language-plaintext highlighter-rouge">build_app.sh</code></li>
</ul>

<p><strong>When to Use Each Approach:</strong></p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Approach</th>
      <th>Python Deps</th>
      <th>Direct <code class="language-plaintext highlighter-rouge">idf.py</code></th>
      <th>Speed</th>
      <th>Maintainability</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Dynamic Source Selection</strong></td>
      <td>âœ… Required</td>
      <td>âœ… Supported</td>
      <td>Medium</td>
      <td>âœ… High</td>
    </tr>
    <tr>
      <td><strong>Conditional Sources</strong></td>
      <td>âŒ None</td>
      <td>âœ… Supported</td>
      <td>âœ… Fast</td>
      <td>âŒ Low</td>
    </tr>
    <tr>
      <td><strong>Environment Variables</strong></td>
      <td>âŒ None</td>
      <td>âŒ Not Supported</td>
      <td>âœ… Fast</td>
      <td>âœ… High</td>
    </tr>
  </tbody>
</table></div>

<p><strong>Recommendation:</strong></p>
<ul>
  <li>Use <strong>Environment Variables</strong> for CI-only workflows where you never need direct <code class="language-plaintext highlighter-rouge">idf.py</code></li>
  <li>Use <strong>Dynamic Source Selection</strong> for development workflows with <code class="language-plaintext highlighter-rouge">idf.py</code> support</li>
  <li>Use <strong>Conditional Sources</strong> only if you want to avoid Python dependencies but need <code class="language-plaintext highlighter-rouge">idf.py</code> support</li>
</ul>

<p><strong>Scenario B: Full <code class="language-plaintext highlighter-rouge">idf.py</code> Compatibility (Complete Setup)</strong></p>

<p>If you want to support both CI builds AND direct <code class="language-plaintext highlighter-rouge">idf.py</code> usage for development, you need the full setup:</p>

<p><strong>Project-Level CMakeLists.txt</strong> (complete):</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td><td class="rouge-code"><pre><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.16<span class="p">)</span>

<span class="c1"># CRITICAL: Set variables BEFORE any other processing</span>
<span class="c1"># This ensures they are available during component configuration</span>
<span class="nb">if</span><span class="p">(</span>DEFINED APP_TYPE<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"APP_TYPE from command line: </span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">else</span><span class="p">()</span>
    <span class="nb">set</span><span class="p">(</span>APP_TYPE <span class="s2">"ascii_art"</span><span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"APP_TYPE defaulting to: </span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="nb">if</span><span class="p">(</span>DEFINED BUILD_TYPE<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"BUILD_TYPE from command line: </span><span class="si">${</span><span class="nv">BUILD_TYPE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">else</span><span class="p">()</span>
    <span class="nb">set</span><span class="p">(</span>BUILD_TYPE <span class="s2">"Release"</span><span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>STATUS <span class="s2">"BUILD_TYPE defaulting to: </span><span class="si">${</span><span class="nv">BUILD_TYPE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Validate app type by reading from app_config.yml (single source of truth)</span>
<span class="nb">execute_process</span><span class="p">(</span>
    COMMAND python3 <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/scripts/get_app_info.py"</span> list
    OUTPUT_VARIABLE VALID_APP_TYPES_STRING
    OUTPUT_STRIP_TRAILING_WHITESPACE
    RESULT_VARIABLE APP_LIST_RESULT
    WORKING_DIRECTORY <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">"</span>
<span class="p">)</span>

<span class="nb">if</span><span class="p">(</span>NOT APP_LIST_RESULT EQUAL 0<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Failed to read valid app types from app_config.yml"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Convert space-separated string to CMake list</span>
<span class="nb">string</span><span class="p">(</span>REPLACE <span class="s2">" "</span> <span class="s2">";"</span> VALID_APP_TYPES <span class="s2">"</span><span class="si">${</span><span class="nv">VALID_APP_TYPES_STRING</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="nb">if</span><span class="p">(</span>NOT APP_TYPE IN_LIST VALID_APP_TYPES<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Invalid APP_TYPE: </span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">. Valid types: </span><span class="si">${</span><span class="nv">VALID_APP_TYPES</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Validate build type</span>
<span class="nb">set</span><span class="p">(</span>VALID_BUILD_TYPES <span class="s2">"Debug;Release"</span><span class="p">)</span>
<span class="nb">if</span><span class="p">(</span>NOT BUILD_TYPE IN_LIST VALID_BUILD_TYPES<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Invalid BUILD_TYPE: </span><span class="si">${</span><span class="nv">BUILD_TYPE</span><span class="si">}</span><span class="s2">. Valid types: </span><span class="si">${</span><span class="nv">VALID_BUILD_TYPES</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># CRITICAL: Set these as global variables for all components</span>
<span class="nb">set</span><span class="p">(</span>APP_TYPE <span class="s2">"</span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">"</span> CACHE STRING <span class="s2">"App type to build"</span> FORCE<span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>BUILD_TYPE <span class="s2">"</span><span class="si">${</span><span class="nv">BUILD_TYPE</span><span class="si">}</span><span class="s2">"</span> CACHE STRING <span class="s2">"Build type (Debug/Release)"</span> FORCE<span class="p">)</span>

<span class="c1"># Include ESP-IDF build system</span>
<span class="nb">include</span><span class="p">(</span>$ENV{IDF_PATH}/tools/cmake/project.cmake<span class="p">)</span>

<span class="c1"># Set project name based on app type</span>
<span class="nb">project</span><span class="p">(</span>esp32_iid_<span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span>_app<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Component-Level CMakeLists.txt</strong> (complete):</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
</pre></td><td class="rouge-code"><pre><span class="c1"># Flexible main component for different app types</span>
<span class="c1"># Determine source file based on APP_TYPE</span>

<span class="c1"># Get app type from parent (set by project-level CMakeLists.txt)</span>
<span class="nb">if</span><span class="p">(</span>NOT DEFINED APP_TYPE<span class="p">)</span>
    <span class="nb">set</span><span class="p">(</span>APP_TYPE <span class="s2">"main"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Get source file from centralized configuration</span>
<span class="nb">execute_process</span><span class="p">(</span>
    COMMAND python3 <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/../scripts/get_app_info.py"</span> validate <span class="s2">"</span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">"</span>
    RESULT_VARIABLE VALIDATE_RESULT
    OUTPUT_QUIET
    ERROR_QUIET
<span class="p">)</span>

<span class="nb">if</span><span class="p">(</span>NOT VALIDATE_RESULT EQUAL 0<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Unknown APP_TYPE: </span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="nb">execute_process</span><span class="p">(</span>
    COMMAND python3 <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/../scripts/get_app_info.py"</span> source_file <span class="s2">"</span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">"</span>
    OUTPUT_VARIABLE MAIN_SOURCE
    OUTPUT_STRIP_TRAILING_WHITESPACE
    RESULT_VARIABLE SOURCE_RESULT
<span class="p">)</span>

<span class="nb">if</span><span class="p">(</span>NOT SOURCE_RESULT EQUAL 0<span class="p">)</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Failed to get source file for APP_TYPE: </span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Check if source file exists and handle path resolution</span>
<span class="nb">set</span><span class="p">(</span>SOURCE_FILE_PATH <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">MAIN_SOURCE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">if</span><span class="p">(</span>NOT EXISTS <span class="s2">"</span><span class="si">${</span><span class="nv">SOURCE_FILE_PATH</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">set</span><span class="p">(</span>SOURCE_FILE_PATH <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_LIST_DIR</span><span class="si">}</span><span class="s2">/</span><span class="si">${</span><span class="nv">MAIN_SOURCE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">if</span><span class="p">(</span>NOT EXISTS <span class="s2">"</span><span class="si">${</span><span class="nv">SOURCE_FILE_PATH</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Source file not found: </span><span class="si">${</span><span class="nv">MAIN_SOURCE</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">endif</span><span class="p">()</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Determine include paths based on environment</span>
<span class="nb">if</span><span class="p">(</span>EXISTS <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/../inc"</span><span class="p">)</span>
    <span class="nb">set</span><span class="p">(</span>INC_BASE_PATH <span class="s2">"../inc"</span><span class="p">)</span>
<span class="nb">elseif</span><span class="p">(</span>EXISTS <span class="s2">"</span><span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span><span class="s2">/../../../inc"</span><span class="p">)</span>
    <span class="nb">set</span><span class="p">(</span>INC_BASE_PATH <span class="s2">"../../../inc"</span><span class="p">)</span>
<span class="nb">else</span><span class="p">()</span>
    <span class="nb">message</span><span class="p">(</span>FATAL_ERROR <span class="s2">"Cannot find inc directory"</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Register component with dynamic source file</span>
<span class="nf">idf_component_register</span><span class="p">(</span>
    SRCS <span class="s2">"</span><span class="si">${</span><span class="nv">MAIN_SOURCE</span><span class="si">}</span><span class="s2">"</span>
    INCLUDE_DIRS <span class="s2">"."</span> <span class="s2">"</span><span class="si">${</span><span class="nv">INC_BASE_PATH</span><span class="si">}</span><span class="s2">"</span> <span class="s2">"</span><span class="si">${</span><span class="nv">INC_BASE_PATH</span><span class="si">}</span><span class="s2">/base"</span> <span class="s2">"</span><span class="si">${</span><span class="nv">INC_BASE_PATH</span><span class="si">}</span><span class="s2">/mcu/esp32"</span>
    REQUIRES driver esp_timer freertos iid-espidf
<span class="p">)</span>

<span class="c1"># Set C++ standard</span>
<span class="nb">target_compile_features</span><span class="p">(</span><span class="si">${</span><span class="nv">COMPONENT_LIB</span><span class="si">}</span> PRIVATE cxx_std_17<span class="p">)</span>

<span class="c1"># Set compiler flags based on build type</span>
<span class="nb">if</span><span class="p">(</span>BUILD_TYPE STREQUAL <span class="s2">"Debug"</span><span class="p">)</span>
    <span class="nb">target_compile_options</span><span class="p">(</span><span class="si">${</span><span class="nv">COMPONENT_LIB</span><span class="si">}</span> PRIVATE
        -Wall -Wextra -Wpedantic -O0 -g3 -DDEBUG
    <span class="p">)</span>
<span class="nb">else</span><span class="p">()</span>
    <span class="nb">target_compile_options</span><span class="p">(</span><span class="si">${</span><span class="nv">COMPONENT_LIB</span><span class="si">}</span> PRIVATE
        -Wall -Wextra -Wpedantic -O2 -g -DNDEBUG
    <span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>

<span class="c1"># Add compile definitions for each example type</span>
<span class="nb">target_compile_definitions</span><span class="p">(</span><span class="si">${</span><span class="nv">COMPONENT_LIB</span><span class="si">}</span> PRIVATE 
    <span class="s2">"EXAMPLE_TYPE_</span><span class="si">${</span><span class="nv">APP_TYPE</span><span class="si">}</span><span class="s2">=1"</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Why This Full Setup is Needed for <code class="language-plaintext highlighter-rouge">idf.py</code> Compatibility:</strong></p>

<ol>
  <li><strong>Command Line Support</strong>: <code class="language-plaintext highlighter-rouge">idf.py build -DAPP_TYPE=gpio_test -DBUILD_TYPE=Release</code></li>
  <li><strong>Validation</strong>: Ensures app types exist in <code class="language-plaintext highlighter-rouge">app_config.yml</code> before building</li>
  <li><strong>Dynamic Source Selection</strong>: Gets the correct source file for each app type</li>
  <li><strong>Project Naming</strong>: Sets project name dynamically based on app type</li>
  <li><strong>Development Workflow</strong>: Enables developers to build directly with <code class="language-plaintext highlighter-rouge">idf.py</code></li>
</ol>

<p><strong>Usage Examples:</strong></p>

<p><strong>CI Builds (both scenarios work):</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c"># Uses build_app.sh which handles everything</span>
./build_app.sh gpio_test Release
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Direct <code class="language-plaintext highlighter-rouge">idf.py</code> Usage (only Scenario B works):</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="c"># Direct idf.py usage for development</span>
idf.py build <span class="nt">-DAPP_TYPE</span><span class="o">=</span>gpio_test <span class="nt">-DBUILD_TYPE</span><span class="o">=</span>Release
idf.py flash <span class="nt">-DAPP_TYPE</span><span class="o">=</span>gpio_test <span class="nt">-DBUILD_TYPE</span><span class="o">=</span>Release
idf.py monitor
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Recommendation:</strong></p>
<ul>
  <li><strong>Use Scenario A</strong> if you only use CI workflows and never need direct <code class="language-plaintext highlighter-rouge">idf.py</code> usage</li>
  <li><strong>Use Scenario B</strong> if you want full development workflow support with <code class="language-plaintext highlighter-rouge">idf.py</code></li>
</ul>
<h4 id="7-how-build_appsh-works-with-both-scenarios">
  
  
    <a href="#7-how-build_appsh-works-with-both-scenarios" class="anchor-heading" aria-labelledby="7-how-build_appsh-works-with-both-scenarios"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>7. How build_app.sh Works with Both Scenarios</strong>
  
  
</h4>
    

<p>The <code class="language-plaintext highlighter-rouge">build_app.sh</code> script is designed to work with both CMakeLists.txt scenarios:</p>

<p><strong>Key Script Features:</strong></p>
<ul>
  <li><strong>Automatic ESP-IDF Setup</strong>: Sources the correct ESP-IDF version</li>
  <li><strong>Source File Discovery</strong>: Gets source file from <code class="language-plaintext highlighter-rouge">app_config.yml</code> and exports as <code class="language-plaintext highlighter-rouge">APP_SOURCE_FILE</code></li>
  <li><strong>Parameter Passing</strong>: Calls <code class="language-plaintext highlighter-rouge">idf.py</code> with <code class="language-plaintext highlighter-rouge">-DAPP_TYPE</code>, <code class="language-plaintext highlighter-rouge">-DAPP_SOURCE_FILE</code>, and <code class="language-plaintext highlighter-rouge">-DBUILD_TYPE</code></li>
  <li><strong>Build Directory Management</strong>: Creates organized build directories</li>
  <li><strong>Size Analysis</strong>: Generates size reports and metadata</li>
  <li><strong>Error Handling</strong>: Validates combinations before building</li>
</ul>

<p><strong>Script Call Pattern:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c"># build_app.sh discovers source file and calls idf.py like this:</span>
<span class="c"># 1. Get source file from app_config.yml</span>
<span class="nv">SOURCE_FILE</span><span class="o">=</span><span class="si">$(</span>python3 <span class="s2">"</span><span class="k">${</span><span class="nv">SCRIPT_DIR</span><span class="k">}</span><span class="s2">/get_app_info.py"</span> source_file <span class="s2">"</span><span class="k">${</span><span class="nv">APP_TYPE</span><span class="k">}</span><span class="s2">"</span><span class="si">)</span>
<span class="nb">export </span><span class="nv">APP_SOURCE_FILE</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">SOURCE_FILE</span><span class="k">}</span><span class="s2">"</span>

<span class="c"># 2. Call idf.py with all necessary variables</span>
idf.py <span class="nt">-B</span> <span class="s2">"</span><span class="nv">$BUILD_DIR</span><span class="s2">"</span> <span class="nt">-D</span> <span class="nv">CMAKE_BUILD_TYPE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$BUILD_TYPE</span><span class="s2">"</span> <span class="nt">-D</span> <span class="nv">BUILD_TYPE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$BUILD_TYPE</span><span class="s2">"</span> <span class="nt">-D</span> <span class="nv">APP_TYPE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$APP_TYPE</span><span class="s2">"</span> <span class="nt">-D</span> <span class="nv">APP_SOURCE_FILE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$SOURCE_FILE</span><span class="s2">"</span> <span class="nt">-D</span> <span class="nv">IDF_CCACHE_ENABLE</span><span class="o">=</span><span class="s2">"</span><span class="nv">$USE_CCACHE</span><span class="s2">"</span> reconfigure
idf.py <span class="nt">-B</span> <span class="s2">"</span><span class="nv">$BUILD_DIR</span><span class="s2">"</span> build
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>How It Works with Scenario A (Ultra-Minimal CMakeLists.txt):</strong></p>
<ul>
  <li>Script discovers source file from <code class="language-plaintext highlighter-rouge">app_config.yml</code> and sets <code class="language-plaintext highlighter-rouge">APP_SOURCE_FILE</code> environment variable</li>
  <li>Script passes <code class="language-plaintext highlighter-rouge">-DAPP_TYPE=gpio_test</code> and <code class="language-plaintext highlighter-rouge">-DAPP_SOURCE_FILE=GpioComprehensiveTest.cpp</code> to <code class="language-plaintext highlighter-rouge">idf.py</code></li>
  <li>CMakeLists.txt simply uses the <code class="language-plaintext highlighter-rouge">APP_SOURCE_FILE</code> variable provided by the script</li>
  <li>Script handles all app selection and source file discovery logic</li>
  <li>Perfect for CI-only workflows</li>
</ul>

<p><strong>How It Works with Scenario B (Full CMakeLists.txt):</strong></p>
<ul>
  <li>Script discovers source file from <code class="language-plaintext highlighter-rouge">app_config.yml</code> and sets <code class="language-plaintext highlighter-rouge">APP_SOURCE_FILE</code> environment variable</li>
  <li>Script passes <code class="language-plaintext highlighter-rouge">-DAPP_TYPE=gpio_test</code> and <code class="language-plaintext highlighter-rouge">-DAPP_SOURCE_FILE=GpioComprehensiveTest.cpp</code> to <code class="language-plaintext highlighter-rouge">idf.py</code></li>
  <li>CMakeLists.txt can use either the script-provided <code class="language-plaintext highlighter-rouge">APP_SOURCE_FILE</code> or do its own discovery</li>
  <li>Both script and CMakeLists.txt work together</li>
  <li>Enables both CI and development workflows</li>
</ul>

<p><strong>Script Parameters:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c"># Basic usage</span>
./build_app.sh gpio_test Release

<span class="c"># With ESP-IDF version</span>
./build_app.sh gpio_test Release release/v5.5

<span class="c"># With project path (for CI)</span>
./build_app.sh <span class="nt">--project-path</span> /path/to/project gpio_test Release

<span class="c"># Clean build</span>
./build_app.sh gpio_test Release <span class="nt">--clean</span>

<span class="c"># List available apps</span>
./build_app.sh list

<span class="c"># Show app information</span>
./build_app.sh info gpio_test
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h4 id="8-submodule-integration">
  
  
    <a href="#8-submodule-integration" class="anchor-heading" aria-labelledby="8-submodule-integration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>8. Submodule Integration</strong>
  
  
</h4>
    

<p>The <code class="language-plaintext highlighter-rouge">hf-espidf-project-tools</code> submodule provides the essential scripts:</p>

<p><strong>Required Scripts:</strong></p>
<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">generate_matrix.py</code></strong>: Reads <code class="language-plaintext highlighter-rouge">app_config.yml</code> and generates build matrix</li>
  <li><strong><code class="language-plaintext highlighter-rouge">build_app.sh</code></strong>: Builds specific app with given parameters</li>
  <li><strong><code class="language-plaintext highlighter-rouge">get_app_info.py</code></strong>: Extracts app information from configuration</li>
  <li><strong><code class="language-plaintext highlighter-rouge">config_loader.sh</code></strong>: Loads and validates configuration</li>
</ul>

<p><strong>Submodule Setup:</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># Add submodule</span>
git submodule add https://github.com/N3b3x/hf-espidf-project-tools.git examples/esp32/scripts

<span class="c"># Initialize submodule</span>
git submodule update <span class="nt">--init</span> <span class="nt">--recursive</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Directory Structure:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre>your-project/
â”œâ”€â”€ examples/esp32/
â”‚   â”œâ”€â”€ CMakeLists.txt              # Project-level CMakeLists.txt
â”‚   â”œâ”€â”€ app_config.yml              # Build configuration
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ AsciiArtComprehensiveTest.cpp
â”‚   â”‚   â”œâ”€â”€ GpioComprehensiveTest.cpp
â”‚   â”‚   â”œâ”€â”€ AdcComprehensiveTest.cpp
â”‚   â”‚   â””â”€â”€ CMakeLists.txt          # Component-level CMakeLists.txt
â”‚   â””â”€â”€ scripts/  # Submodule
â”‚       â”œâ”€â”€ generate_matrix.py
â”‚       â”œâ”€â”€ build_app.sh
â”‚       â”œâ”€â”€ get_app_info.py
â”‚       â””â”€â”€ config_loader.sh
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h4 id="9-build-process-flow">
  
  
    <a href="#9-build-process-flow" class="anchor-heading" aria-labelledby="9-build-process-flow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>9. Build Process Flow</strong>
  
  
</h4>
    

<ol>
  <li><strong>Configuration Reading</strong>: <code class="language-plaintext highlighter-rouge">generate_matrix.py</code> reads <code class="language-plaintext highlighter-rouge">app_config.yml</code></li>
  <li><strong>Matrix Generation</strong>: Creates all valid build combinations</li>
  <li><strong>Parallel Execution</strong>: Each combination runs as separate job</li>
  <li><strong>Dynamic Building</strong>: Each job calls <code class="language-plaintext highlighter-rouge">build_app.sh</code> with specific parameters</li>
  <li><strong>CMake Integration</strong>: CMakeLists.txt uses <code class="language-plaintext highlighter-rouge">APP_SOURCE_FILE</code> from build_app.sh</li>
  <li><strong>Artifact Collection</strong>: All builds are collected and organized</li>
</ol>
<h4 id="10-how-app-type-selection-works">
  
  
    <a href="#10-how-app-type-selection-works" class="anchor-heading" aria-labelledby="10-how-app-type-selection-works"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>10. How App Type Selection Works</strong>
  
  
</h4>
    

<p>The app type selection system enables dynamic building of different applications from the same codebase:</p>

<p><strong>Step 1: Command Line Input</strong></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c"># CI builds with specific app type</span>
idf.py build <span class="nt">-DAPP_TYPE</span><span class="o">=</span>gpio_test <span class="nt">-DBUILD_TYPE</span><span class="o">=</span>Release

<span class="c"># Development builds with default app type</span>
idf.py build  <span class="c"># Uses default from app_config.yml</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Step 2: Project-Level Validation</strong></p>
<ul>
  <li>Project-level CMakeLists.txt receives <code class="language-plaintext highlighter-rouge">APP_TYPE</code> and <code class="language-plaintext highlighter-rouge">BUILD_TYPE</code></li>
  <li>Validates <code class="language-plaintext highlighter-rouge">APP_TYPE</code> against <code class="language-plaintext highlighter-rouge">app_config.yml</code> using <code class="language-plaintext highlighter-rouge">get_app_info.py list</code></li>
  <li>Sets global variables for all components</li>
  <li>Sets project name dynamically: <code class="language-plaintext highlighter-rouge">esp32_iid_${APP_TYPE}_app</code></li>
</ul>

<p><strong>Step 3: Component-Level Source Selection</strong></p>
<ul>
  <li>Component-level CMakeLists.txt gets <code class="language-plaintext highlighter-rouge">APP_TYPE</code> from parent</li>
  <li>Calls <code class="language-plaintext highlighter-rouge">get_app_info.py source_file ${APP_TYPE}</code> to get source file name</li>
  <li>Validates source file exists in main/ directory</li>
  <li>Registers component with dynamic source file</li>
</ul>

<p><strong>Step 4: Build Configuration</strong></p>
<ul>
  <li>Sets include paths based on environment (CI vs development)</li>
  <li>Applies build type-specific compiler flags</li>
  <li>Adds app-specific compile definitions: <code class="language-plaintext highlighter-rouge">EXAMPLE_TYPE_${APP_TYPE}=1</code></li>
</ul>

<p><strong>Key Benefits:</strong></p>
<ul>
  <li><strong>Single Codebase</strong>: All apps share the same project structure</li>
  <li><strong>Dynamic Selection</strong>: Build any app without code changes</li>
  <li><strong>Validation</strong>: Ensures app types exist in configuration</li>
  <li><strong>Flexibility</strong>: Easy to add new apps by updating <code class="language-plaintext highlighter-rouge">app_config.yml</code></li>
  <li><strong>CI Integration</strong>: Matrix builds automatically test all combinations</li>
</ul>
<h4 id="11-app_configyml-structure">
  
  
    <a href="#11-app_configyml-structure" class="anchor-heading" aria-labelledby="11-app_configyml-structure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>11. app_config.yml Structure</strong>
  
  
</h4>
    

<p>The <code class="language-plaintext highlighter-rouge">app_config.yml</code> file is the central configuration that enables parallel building:</p>

<p><strong>Global Metadata:</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="na">metadata</span><span class="pi">:</span>
  <span class="na">project</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ESP32</span><span class="nv"> </span><span class="s">HardFOC</span><span class="nv"> </span><span class="s">Interface</span><span class="nv"> </span><span class="s">Wrapper"</span>
  <span class="na">default_app</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ascii_art"</span>
  <span class="na">target</span><span class="pi">:</span> <span class="s2">"</span><span class="s">esp32c6"</span>
  <span class="na">idf_versions</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">release/v5.5"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">release/v5.4"</span><span class="pi">]</span>
  <span class="na">build_types</span><span class="pi">:</span> <span class="pi">[[</span><span class="s2">"</span><span class="s">Debug"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">Release"</span><span class="pi">],</span> <span class="pi">[</span><span class="s2">"</span><span class="s">Debug"</span><span class="pi">]]</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>App Definitions:</strong></p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="na">apps</span><span class="pi">:</span>
  <span class="na">ascii_art</span><span class="pi">:</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">ASCII</span><span class="nv"> </span><span class="s">art</span><span class="nv"> </span><span class="s">generator</span><span class="nv"> </span><span class="s">example"</span>
    <span class="na">source_file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">AsciiArtComprehensiveTest.cpp"</span>
    <span class="na">category</span><span class="pi">:</span> <span class="s2">"</span><span class="s">utility"</span>
    <span class="na">idf_versions</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">release/v5.5"</span><span class="pi">]</span>
    <span class="na">build_types</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">Debug"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">Release"</span><span class="pi">]</span>
    <span class="na">ci_enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">featured</span><span class="pi">:</span> <span class="no">true</span>

  <span class="na">gpio_test</span><span class="pi">:</span>
    <span class="na">description</span><span class="pi">:</span> <span class="s2">"</span><span class="s">GPIO</span><span class="nv"> </span><span class="s">peripheral</span><span class="nv"> </span><span class="s">comprehensive</span><span class="nv"> </span><span class="s">testing"</span>
    <span class="na">source_file</span><span class="pi">:</span> <span class="s2">"</span><span class="s">GpioComprehensiveTest.cpp"</span>
    <span class="na">category</span><span class="pi">:</span> <span class="s2">"</span><span class="s">peripheral"</span>
    <span class="na">idf_versions</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">release/v5.5"</span><span class="pi">]</span>
    <span class="na">build_types</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">Debug"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">Release"</span><span class="pi">]</span>
    <span class="na">ci_enabled</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">featured</span><span class="pi">:</span> <span class="no">true</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Key Features:</strong></p>
<ul>
  <li><strong>Hierarchical Configuration</strong>: Global settings apply to all apps by default</li>
  <li><strong>App Overrides</strong>: Individual apps can override global settings</li>
  <li><strong>Source File Mapping</strong>: Each app maps to its specific source file</li>
  <li><strong>Build Type Control</strong>: Apps can specify which build types to use</li>
  <li><strong>CI Integration</strong>: <code class="language-plaintext highlighter-rouge">ci_enabled</code> flag controls which apps are built in CI</li>
</ul>
<h4 id="12-parallel-building-benefits">
  
  
    <a href="#12-parallel-building-benefits" class="anchor-heading" aria-labelledby="12-parallel-building-benefits"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>12. Parallel Building Benefits</strong>
  
  
</h4>
    

<p>This setup enables powerful parallel building capabilities:</p>

<p><strong>Multiple Apps Ã— Multiple Build Types Ã— Multiple IDF Versions:</strong></p>
<ul>
  <li><strong>12 apps</strong> Ã— <strong>2 build types</strong> Ã— <strong>2 IDF versions</strong> = <strong>48 parallel builds</strong></li>
  <li>Each build runs independently and in parallel</li>
  <li>No dependency between different app builds</li>
  <li>Maximum utilization of GitHub Actions runners</li>
</ul>

<p><strong>Example Build Matrix:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre>ascii_art + Debug + v5.5     â”‚ gpio_test + Debug + v5.5
ascii_art + Release + v5.5   â”‚ gpio_test + Release + v5.5
ascii_art + Debug + v5.4     â”‚ gpio_test + Debug + v5.4
adc_test + Debug + v5.5      â”‚ uart_test + Debug + v5.5
adc_test + Release + v5.5    â”‚ uart_test + Release + v5.5
... (all combinations)       â”‚ ... (all combinations)
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Time Savings:</strong></p>
<ul>
  <li><strong>Sequential</strong>: 48 builds Ã— 5 minutes = 4 hours</li>
  <li><strong>Parallel</strong>: 48 builds Ã· 20 runners = ~12 minutes</li>
  <li><strong>Speedup</strong>: 20x faster with parallel execution</li>
</ul>
<h4 id="13-key-scripts-and-their-roles">
  
  
    <a href="#13-key-scripts-and-their-roles" class="anchor-heading" aria-labelledby="13-key-scripts-and-their-roles"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>13. Key Scripts and Their Roles</strong>
  
  
</h4>
    

<p>The <code class="language-plaintext highlighter-rouge">hf-espidf-project-tools</code> submodule provides essential scripts that enable the dynamic build system:</p>

<p><strong><code class="language-plaintext highlighter-rouge">generate_matrix.py</code></strong></p>
<ul>
  <li><strong>Purpose</strong>: Reads <code class="language-plaintext highlighter-rouge">app_config.yml</code> and generates build matrix</li>
  <li><strong>Input</strong>: <code class="language-plaintext highlighter-rouge">app_config.yml</code> configuration file</li>
  <li><strong>Output</strong>: JSON matrix with all valid build combinations</li>
  <li><strong>Usage</strong>: Called by CI workflow to create parallel build jobs</li>
</ul>

<p><strong><code class="language-plaintext highlighter-rouge">get_app_info.py</code></strong></p>
<ul>
  <li><strong>Purpose</strong>: Extracts app information from <code class="language-plaintext highlighter-rouge">app_config.yml</code></li>
  <li><strong>Commands</strong>:
    <ul>
      <li><code class="language-plaintext highlighter-rouge">list</code>: Returns all valid app types</li>
      <li><code class="language-plaintext highlighter-rouge">validate &lt;app_type&gt;</code>: Validates app type exists</li>
      <li><code class="language-plaintext highlighter-rouge">source_file &lt;app_type&gt;</code>: Returns source file name for app</li>
      <li><code class="language-plaintext highlighter-rouge">info &lt;app_type&gt;</code>: Returns detailed app information</li>
    </ul>
  </li>
  <li><strong>Usage</strong>: Called by CMakeLists.txt to get app-specific data</li>
</ul>

<p><strong><code class="language-plaintext highlighter-rouge">build_app.sh</code></strong></p>
<ul>
  <li><strong>Purpose</strong>: Builds specific app with given parameters</li>
  <li><strong>Parameters</strong>: <code class="language-plaintext highlighter-rouge">--project-path</code>, app name, build type, IDF version</li>
  <li><strong>Usage</strong>: Called by CI workflow for each matrix combination</li>
</ul>

<p><strong><code class="language-plaintext highlighter-rouge">config_loader.sh</code></strong></p>
<ul>
  <li><strong>Purpose</strong>: Loads and validates configuration</li>
  <li><strong>Usage</strong>: Provides configuration utilities for other scripts</li>
</ul>

<p><strong>Script Integration Flow:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>CI Workflow â†’ generate_matrix.py â†’ Build Matrix
     â†“
Each Build Job â†’ build_app.sh â†’ idf.py build
     â†“
CMakeLists.txt â†’ APP_SOURCE_FILE â†’ Source File Selection
     â†“
ESP-IDF Build â†’ Firmware Binary
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="matrix-generation">
  
  
    <a href="#matrix-generation" class="anchor-heading" aria-labelledby="matrix-generation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Matrix Generation</strong>
  
  
</h3>
    

<p>The workflow calls your projectâ€™s <code class="language-plaintext highlighter-rouge">generate_matrix.py</code> script to create the build matrix:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="c1"># Expected output format from generate_matrix.py
</span><span class="p">{</span>
  <span class="s">"include"</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s">"idf_version"</span><span class="p">:</span> <span class="s">"release/v5.5"</span><span class="p">,</span>        <span class="c1"># Git format for ESP-IDF cloning
</span>      <span class="s">"idf_version_docker"</span><span class="p">:</span> <span class="s">"v5.5"</span><span class="p">,</span>         <span class="c1"># Docker-safe format for artifacts
</span>      <span class="s">"idf_version_file"</span><span class="p">:</span> <span class="s">"release_v5_5"</span><span class="p">,</span>   <span class="c1"># File-safe format for build dirs
</span>      <span class="s">"build_type"</span><span class="p">:</span> <span class="s">"Debug"</span><span class="p">,</span>                <span class="c1"># Build configuration
</span>      <span class="s">"app_name"</span><span class="p">:</span> <span class="s">"gpio_test"</span><span class="p">,</span>              <span class="c1"># Application name
</span>      <span class="s">"target"</span><span class="p">:</span> <span class="s">"esp32c6"</span><span class="p">,</span>                  <span class="c1"># Target MCU
</span>      <span class="s">"config_source"</span><span class="p">:</span> <span class="s">"app"</span>                <span class="c1"># Configuration source
</span>    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="required-scripts">
  
  
    <a href="#required-scripts" class="anchor-heading" aria-labelledby="required-scripts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Required Scripts</strong>
  
  
</h3>
    

<p>Your <code class="language-plaintext highlighter-rouge">hf-espidf-project-tools</code> directory must contain:</p>

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Script</th>
      <th>Purpose</th>
      <th>Required</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">generate_matrix.py</code></td>
      <td>Matrix generator from <code class="language-plaintext highlighter-rouge">app_config.yml</code></td>
      <td>âœ…</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">build_app.sh</code></td>
      <td>Application builder</td>
      <td>âœ…</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">config_loader.sh</code></td>
      <td>Configuration loader</td>
      <td>âœ…</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">requirements.txt</code></td>
      <td>Python dependencies</td>
      <td>âŒ</td>
    </tr>
  </tbody>
</table></div><hr />
<h2 id="ï¸-build-process">
  
  
    <a href="#ï¸-build-process" class="anchor-heading" aria-labelledby="ï¸-build-process"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸ—ï¸ Build Process
  
  
</h2>
    
<h3 id="phase-1-matrix-generation">
  
  
    <a href="#phase-1-matrix-generation" class="anchor-heading" aria-labelledby="phase-1-matrix-generation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Phase 1: Matrix Generation</strong>
  
  
</h3>
    
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Checkout    â”‚â”€â”€â”€â–¶â”‚ Ensure Tools    â”‚â”€â”€â”€â–¶â”‚ Install Python  â”‚â”€â”€â”€â–¶â”‚ Run generate    â”‚â”€â”€â”€â–¶â”‚ Output JSON     â”‚
â”‚ Repo        â”‚    â”‚ Directory       â”‚    â”‚ Deps            â”‚    â”‚ matrix.py       â”‚    â”‚ Matrix          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="phase-2-parallel-build-execution">
  
  
    <a href="#phase-2-parallel-build-execution" class="anchor-heading" aria-labelledby="phase-2-parallel-build-execution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Phase 2: Parallel Build Execution</strong>
  
  
</h3>
    
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Matrix      â”‚
â”‚ Entry       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Checkout    â”‚â”€â”€â”€â–¶â”‚ Cache Python    â”‚â”€â”€â”€â–¶â”‚ Install Python  â”‚â”€â”€â”€â–¶â”‚ ESP-IDF CI      â”‚ â”‚
â”‚  â”‚ Repo        â”‚    â”‚ Deps            â”‚    â”‚ Deps            â”‚    â”‚ Action          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                            â”‚          â”‚
â”‚                                                                            â–¼          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Upload      â”‚â—€â”€â”€â”€â”‚ Build with      â”‚â—€â”€â”€â”€---------------------â”€â”€â”‚ Cache ccache    â”‚ â”‚
â”‚  â”‚ Artifacts   â”‚    â”‚ build_app.sh    â”‚ *ESP-IDF CI HAS IDF RDY*  â”‚                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Matrix      â”‚
â”‚ Exit        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="phase-3-size-reporting">
  
  
    <a href="#phase-3-size-reporting" class="anchor-heading" aria-labelledby="phase-3-size-reporting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Phase 3: Size Reporting</strong>
  
  
</h3>
    
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Download        â”‚â”€â”€â”€â–¶â”‚ Parse Size      â”‚â”€â”€â”€â–¶â”‚ Generate        â”‚â”€â”€â”€â–¶â”‚ Comment on      â”‚
â”‚ Artifacts       â”‚    â”‚ Data            â”‚    â”‚ Markdown        â”‚    â”‚ PR              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="detailed-build-steps">
  
  
    <a href="#detailed-build-steps" class="anchor-heading" aria-labelledby="detailed-build-steps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Detailed Build Steps</strong>
  
  
</h3>
    

<ol>
  <li><strong>ğŸ” Matrix Generation</strong>:
    <ul>
      <li>Validates project tools directory</li>
      <li>Runs <code class="language-plaintext highlighter-rouge">generate_matrix.py</code> with project configuration</li>
      <li>Outputs JSON matrix for parallel execution</li>
    </ul>
  </li>
  <li><strong>ğŸ—ï¸ Direct Project Building</strong>:
    <ul>
      <li>ESP-IDF CI action works directly with project files</li>
      <li>No file copying or workspace preparation needed</li>
      <li>Builds directly from source directory structure</li>
    </ul>
  </li>
  <li><strong>ğŸ›¡ï¸ ESP-IDF Environment</strong>:
    <ul>
      <li>Uses <code class="language-plaintext highlighter-rouge">espressif/esp-idf-ci-action@v1</code> for reliable environment</li>
      <li>Sets up ESP-IDF tools and dependencies</li>
      <li>Configures target and build parameters</li>
    </ul>
  </li>
  <li><strong>âš¡ Build Execution</strong>:
    <ul>
      <li>Runs <code class="language-plaintext highlighter-rouge">build_app.sh</code> with matrix parameters</li>
      <li>Handles incremental builds with ccache</li>
      <li>Generates size analysis and metadata</li>
    </ul>
  </li>
  <li><strong>ğŸ“¦ Artifact Management</strong>:
    <ul>
      <li>Uploads firmware binaries and build outputs</li>
      <li>Organizes artifacts by app, version, and build type</li>
      <li>Sets appropriate retention policies</li>
    </ul>
  </li>
  <li><strong>ğŸ“Š Size Reporting</strong>:
    <ul>
      <li>Aggregates size data from all builds</li>
      <li>Creates comprehensive PR comments</li>
      <li>Enforces size budgets (optional)</li>
    </ul>
  </li>
</ol><hr />
<h2 id="-troubleshooting">
  
  
    <a href="#-troubleshooting" class="anchor-heading" aria-labelledby="-troubleshooting"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸ” Troubleshooting
  
  
</h2>
    
<h3 id="common-issues--solutions">
  
  
    <a href="#common-issues--solutions" class="anchor-heading" aria-labelledby="common-issues--solutions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Common Issues &amp; Solutions</strong>
  
  
</h3>
    
<h4 id="matrix-generation-fails">
  
  
    <a href="#matrix-generation-fails" class="anchor-heading" aria-labelledby="matrix-generation-fails"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Matrix Generation Fails</strong>
  
  
</h4>
    
<p><strong>Symptoms</strong>: â€œMatrix generation failedâ€ or â€œNo matrix entries foundâ€
<strong>Solutions</strong>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c"># Check script exists and is executable</span>
<span class="nb">ls</span> <span class="nt">-la</span> hf-espidf-project-tools/generate_matrix.py
<span class="nb">chmod</span> +x hf-espidf-project-tools/generate_matrix.py

<span class="c"># Test matrix generation locally</span>
<span class="nb">cd </span>examples/esp32
python3 hf-espidf-project-tools/generate_matrix.py <span class="nt">--validate</span>

<span class="c"># Check Python dependencies</span>
pip <span class="nb">install </span>pyyaml jq
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h4 id="build-fails">
  
  
    <a href="#build-fails" class="anchor-heading" aria-labelledby="build-fails"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Build Fails</strong>
  
  
</h4>
    
<p><strong>Symptoms</strong>: â€œBuild failedâ€ or â€œESP-IDF not foundâ€
<strong>Solutions</strong>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c"># Verify project structure is ready for building</span>
<span class="nb">ls</span> <span class="nt">-la</span> src/ inc/ examples/
<span class="nb">ls</span> <span class="nt">-la</span> CMakeLists.txt app_config.yml

<span class="c"># Check build_app.sh handles matrix parameters</span>
./hf-espidf-project-tools/build_app.sh <span class="nt">--help</span>

<span class="c"># Validate ESP-IDF version compatibility</span>
python3 hf-espidf-project-tools/generate_matrix.py <span class="nt">--validate</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h4 id="cache-issues">
  
  
    <a href="#cache-issues" class="anchor-heading" aria-labelledby="cache-issues"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Cache Issues</strong>
  
  
</h4>
    
<p><strong>Symptoms</strong>: â€œCache missâ€ or â€œBuild too slowâ€
<strong>Solutions</strong>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c1"># Use clean build to bypass caches</span>
<span class="na">clean_build</span><span class="pi">:</span> <span class="no">true</span>

<span class="c1"># Check cache configuration</span>
<span class="c1"># Cache keys should include relevant file hashes</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h4 id="artifact-upload-fails">
  
  
    <a href="#artifact-upload-fails" class="anchor-heading" aria-labelledby="artifact-upload-fails"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Artifact Upload Fails</strong>
  
  
</h4>
    
<p><strong>Symptoms</strong>: â€œArtifact upload failedâ€ or â€œNo artifacts foundâ€
<strong>Solutions</strong>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c"># Check build outputs exist</span>
<span class="nb">ls</span> <span class="nt">-la</span> build-app-<span class="k">*</span>/

<span class="c"># Verify build_app.sh generates proper outputs</span>
./hf-espidf-project-tools/build_app.sh gpio_test Release

<span class="c"># Check size files are created inside build directory</span>
<span class="nb">ls</span> <span class="nt">-la</span> build-app-<span class="k">*</span>/size.<span class="k">*</span>

<span class="c"># Verify artifact structure</span>
find build-app-<span class="k">*</span>/ <span class="nt">-name</span> <span class="s2">"*.bin"</span> <span class="nt">-o</span> <span class="nt">-name</span> <span class="s2">"*.elf"</span> <span class="nt">-o</span> <span class="nt">-name</span> <span class="s2">"size.*"</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h4 id="size-report-issues">
  
  
    <a href="#size-report-issues" class="anchor-heading" aria-labelledby="size-report-issues"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Size Report Issues</strong>
  
  
</h4>
    
<p><strong>Symptoms</strong>: â€œNo size artifacts foundâ€ or â€œSize data missingâ€
<strong>Solutions</strong>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="c"># Check size files are created in build directory</span>
<span class="nb">ls</span> <span class="nt">-la</span> build-app-<span class="k">*</span>/size.<span class="k">*</span>

<span class="c"># Verify size.info contains metadata</span>
<span class="nb">cat </span>build-app-<span class="k">*</span>/size.info

<span class="c"># Check build_app.sh size generation</span>
./hf-espidf-project-tools/build_app.sh gpio_test Release
<span class="nb">ls</span> <span class="nt">-la</span> build-app-<span class="k">*</span>/size.<span class="k">*</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h4 id="size-budget-violations">
  
  
    <a href="#size-budget-violations" class="anchor-heading" aria-labelledby="size-budget-violations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Size Budget Violations</strong>
  
  
</h4>
    
<p><strong>Symptoms</strong>: â€œSize budget exceededâ€ or build fails due to size limits
<strong>Solutions</strong>:</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c1"># Disable size budget enforcement temporarily</span>
<span class="na">max_dec_total</span><span class="pi">:</span> <span class="s2">"</span><span class="s">0"</span>

<span class="c1"># Increase size limit (in bytes)</span>
<span class="na">max_dec_total</span><span class="pi">:</span> <span class="s2">"</span><span class="s">2000000"</span>  <span class="c1"># 2MB limit</span>

<span class="c1"># Use dynamic size limits based on build type</span>
<span class="na">max_dec_total</span><span class="pi">:</span> <span class="s">$</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c"># Check current firmware sizes</span>
<span class="nb">grep</span> <span class="nt">-E</span> <span class="s1">'^\s*text\s+data\s+bss\s+dec'</span> build-app-<span class="k">*</span>/size.txt

<span class="c"># Analyze size breakdown</span>
python3 <span class="nt">-c</span> <span class="s2">"
import re
with open('build-app-*/size.txt', 'r') as f:
    for line in f:
        if 'dec' in line:
            print(line.strip())
"</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h4 id="build_appsh-no-such-file-or-directory">
  
  
    <a href="#build_appsh-no-such-file-or-directory" class="anchor-heading" aria-labelledby="build_appsh-no-such-file-or-directory"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>â€œbuild_app.sh: No such file or directoryâ€</strong>
  
  
</h4>
    

<p><strong>Cause</strong>: Path resolution or submodule checkout issues</p>

<p><strong>Solutions</strong>:</p>
<ol>
  <li><strong>Check Submodule Status</strong>: Verify submodule is properly initialized
    <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>git submodule status
git submodule update <span class="nt">--init</span> <span class="nt">--recursive</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li><strong>Verify Paths</strong>: Check that <code class="language-plaintext highlighter-rouge">project_tools_dir</code> points to the correct location</li>
  <li><strong>Check Repository Structure</strong>: Ensure the tools directory contains required scripts</li>
  <li><strong>For Explicit Paths</strong>: When <code class="language-plaintext highlighter-rouge">project_tools_dir</code> is specified, the workflow uses that path directly (no auto-cloning)</li>
</ol>
<h4 id="project-tools-directory-not-found">
  
  
    <a href="#project-tools-directory-not-found" class="anchor-heading" aria-labelledby="project-tools-directory-not-found"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>â€œProject tools directory not foundâ€</strong>
  
  
</h4>
    

<p><strong>Cause</strong>: Incorrect path configuration or missing tools directory</p>

<p><strong>Solutions</strong>:</p>
<ol>
  <li><strong>Verify Paths</strong>: Ensure paths are relative to repository root</li>
  <li><strong>Check Auto-clone</strong>: Set <code class="language-plaintext highlighter-rouge">auto_clone_tools: true</code> if not using submodules</li>
  <li><strong>Manual Setup</strong>: Clone tools repository manually if needed</li>
</ol>
<h4 id="submodule-detection-issues">
  
  
    <a href="#submodule-detection-issues" class="anchor-heading" aria-labelledby="submodule-detection-issues"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Submodule Detection Issues</strong>
  
  
</h4>
    

<p><strong>Symptoms</strong>: Workflow runs but canâ€™t find scripts in submodule</p>

<p><strong>Solutions</strong>:</p>
<ol>
  <li><strong>Specify <code class="language-plaintext highlighter-rouge">project_tools_dir</code></strong> - When using submodules, explicitly set the path to the submodule</li>
  <li><strong>Verify Submodule URL</strong>: Ensure submodule points to correct repository</li>
  <li><strong>Check Submodule Commit</strong>: Ensure submodule is at a valid commit</li>
  <li><strong>Auto-clone Logic</strong>: Auto-clone only happens when <code class="language-plaintext highlighter-rouge">project_tools_dir</code> is not specified</li>
</ol>
<h3 id="debug-information">
  
  
    <a href="#debug-information" class="anchor-heading" aria-labelledby="debug-information"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Debug Information</strong>
  
  
</h3>
    

<p>The workflow provides detailed logging to help diagnose issues:</p>
<ul>
  <li>Path resolution details</li>
  <li>Submodule detection and validation</li>
  <li>Available directory listings</li>
  <li>Script validation results</li>
</ul>
<h3 id="debug-mode">
  
  
    <a href="#debug-mode" class="anchor-heading" aria-labelledby="debug-mode"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Debug Mode</strong>
  
  
</h3>
    

<p>Enable verbose output for debugging:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="na">jobs</span><span class="pi">:</span>
  <span class="na">build</span><span class="pi">:</span>
    <span class="na">uses</span><span class="pi">:</span> <span class="s">N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1</span>
    <span class="na">with</span><span class="pi">:</span>
      <span class="na">project_dir</span><span class="pi">:</span> <span class="s">examples/esp32</span>
      <span class="na">clean_build</span><span class="pi">:</span> <span class="no">true</span>  <span class="c1"># Bypass caches for debugging</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p>Enable debug output by setting:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="na">env</span><span class="pi">:</span>
  <span class="na">ACTIONS_STEP_DEBUG</span><span class="pi">:</span> <span class="no">true</span>
  <span class="na">ACTIONS_RUNNER_DEBUG</span><span class="pi">:</span> <span class="no">true</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="local-testing">
  
  
    <a href="#local-testing" class="anchor-heading" aria-labelledby="local-testing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Local Testing</strong>
  
  
</h3>
    

<p>Test the build process locally:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c"># 1. Setup environment</span>
<span class="nb">cd </span>examples/esp32
<span class="nb">source </span>hf-espidf-project-tools/setup_common.sh

<span class="c"># 2. Test matrix generation</span>
python3 hf-espidf-project-tools/generate_matrix.py <span class="nt">--validate</span>

<span class="c"># 3. Test direct building (no setup needed)</span>

<span class="c"># 4. Test build</span>
./hf-espidf-project-tools/build_app.sh gpio_test Release
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="-related-documentation">
  
  
    <a href="#-related-documentation" class="anchor-heading" aria-labelledby="-related-documentation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸ“š Related Documentation
  
  
</h2>
    

<ul>
  <li>ğŸ“– <a href="/hf-espidf-ci-tools/preview/"><strong>Main Documentation</strong></a> - Complete CI tools overview</li>
  <li>ğŸ›¡ï¸ <a href="/hf-espidf-ci-tools/preview/docs/security-workflow/"><strong>Security Workflow</strong></a> - Security auditing and analysis</li>
</ul>
<h3 id="project-tools-documentation">
  
  
    <a href="#project-tools-documentation" class="anchor-heading" aria-labelledby="project-tools-documentation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>Project Tools Documentation</strong>
  
  
</h3>
    

<ul>
  <li>ğŸ—ï¸ <a href="https://github.com/N3b3x/hf-espidf-project-tools"><strong>Build System</strong></a> - Complete build system guide</li>
  <li>Check cache key generation in workflow</li>
  <li>Verify cache paths are accessible</li>
</ul>
<h2 id="-related-workflows">
  
  
    <a href="#-related-workflows" class="anchor-heading" aria-labelledby="-related-workflows"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸ“š Related Workflows
  
  
</h2>
    

<ul>
  <li><strong><a href="/hf-espidf-ci-tools/preview/docs/security-workflow/">Security</a></strong> - Security auditing</li>
</ul>
<h2 id="-related-resources">
  
  
    <a href="#-related-resources" class="anchor-heading" aria-labelledby="-related-resources"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ğŸ”— Related Resources
  
  
</h2>
    

<ul>
  <li><a href="https://github.com/espressif/esp-idf-ci-action">ESP-IDF CI Action</a></li>
  <li><a href="https://docs.github.com/en/actions/using-workflows/caching-dependencies-to-speed-up-workflows">GitHub Actions Caching</a></li>
  <li><a href="https://docs.github.com/en/actions/using-jobs/using-a-matrix-for-your-jobs">Matrix Strategy</a></li>
</ul><hr />

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><a href="/hf-espidf-ci-tools/preview/docs/">â† Previous: Documentation Index</a></td>
      <td><a href="/hf-espidf-ci-tools/preview/docs/security-workflow/">Next: Security Workflow â†’</a></td>
    </tr>
  </tbody>
</table></div>

<div class="table-wrapper"><table>
  <tbody>
    <tr>
      <td><strong>ğŸ“š <a href="/hf-espidf-ci-tools/preview/docs/">All Documentation</a></strong></td>
      <td><strong>ğŸ  <a href="/hf-espidf-ci-tools/preview/">Main README</a></strong></td>
    </tr>
  </tbody>
</table></div>

          

          
            
          
        </main>
        

  <hr>
  <footer>
    

    <p class="text-small text-grey-dk-100 mb-0">Built with â¤ï¸ using <a href='https://just-the-docs.github.io/just-the-docs/'>Just the Docs</a> â€¢ <a href='https://github.com/n3b3x/hf-espidf-ci-tools/blob/main/LICENSE'>MIT License</a> â€¢ <a href='https://github.com/n3b3x/hf-espidf-ci-tools'>View on GitHub</a>
</p>

    
  </footer>


      </div>
    </div>
    
      
<button id="search-button" class="search-button btn-reset" aria-label="Focus on search">
  <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-search"></use></svg>
</button>


<div class="search-overlay"></div>

    
  </div>

  
</body>
</html>

