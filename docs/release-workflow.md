---
layout: default
title: "üì¶ Release Workflow"
description: "Automated ESP32 firmware releases with ru-release-with-artifacts.yml"
nav_order: 4
---

# üì¶ ESP32 Release Workflow

**Automated firmware releases with `ru-release-with-artifacts.yml`**

---

## üéØ Overview

The `ru-release-with-artifacts.yml` workflow provides automated GitHub releases with ESP32 firmware artifacts:

- ‚úÖ **Automatic artifact collection** from build workflows
- ‚úÖ **ESP32 firmware binaries** included in releases
- ‚úÖ **Auto-generated release notes** from GitHub
- ‚úÖ **Tag-based releases** with version management
- ‚úÖ **Build artifact validation** before release

---

## üöÄ Quick Start

### Basic Firmware Release

```yaml
# .github/workflows/release.yml
name: üì¶ Release

on:
  push:
    tags: ['v*']

jobs:
  # Build first (required for artifacts)
  build:
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1
    with:
      project_dir: examples/esp32

  # Release with artifacts
  release:
    needs: [build]
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-release-with-artifacts.yml@v1
    with:
      build_workflow: "esp32-examples-build-ci.yml"
      artifact_pattern: "fw-.*"
    permissions:
      contents: write
```

### Advanced Release Configuration

```yaml
name: üì¶ Advanced Release

on:
  push:
    tags: ['v*']

jobs:
  build:
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1
    with:
      project_dir: examples/esp32

  release:
    needs: [build]
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-release-with-artifacts.yml@v1
    with:
      build_workflow: "esp32-examples-build-ci.yml"
      artifact_pattern: "fw-.*"
      draft: ${{ contains(github.ref_name, 'rc') }}
      prerelease: ${{ contains(github.ref_name, 'beta') }}
      fail_on_no_artifacts: true
    permissions:
      contents: write
```

---

## ‚öôÔ∏è Configuration

### Inputs

| Parameter | Type | Default | Description |
|-----------|------|---------|-------------|
| `build_workflow` | string | `'esp32-examples-build-ci.yml'` | Name of the ESP32 build workflow file |
| `artifact_pattern` | string | `'fw-.*'` | Regex pattern for firmware artifacts to include |
| `draft` | boolean | `false` | Create as draft release |
| `prerelease` | boolean | `false` | Mark as pre-release |
| `tag_name` | string | `github.ref_name` | Custom tag name |
| `fail_on_no_artifacts` | boolean | `false` | Fail if no firmware artifacts found |

### Required Permissions

```yaml
permissions:
  contents: write  # Required for creating releases and downloading artifacts
```

---

## üìã Workflow Dependencies

### Build Workflow Integration

The release workflow depends on a successful ESP32 build that produces firmware artifacts:

```yaml
# Required: ESP32 build workflow that generates fw-* artifacts
jobs:
  build:
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1
    with:
      project_dir: examples/esp32
      # This creates artifacts like: fw-esp32c6-hf-interface-simple
```

### Artifact Naming Convention

Your ESP32 projects should produce artifacts following the pattern:
- `fw-esp32c6-project-name` (standard firmware)
- `fw-esp32s3-advanced-config` (variant builds)
- `fw-*` (any firmware artifact)

---

## üîÑ Release Process

### What Happens

1. **Code Checkout**: Repository is checked out with full history
2. **Artifact Download**: Firmware artifacts are downloaded from the specified build workflow
3. **Release Creation**: GitHub release is created with:
   - **Firmware binaries** attached as release assets
   - **Source code** archives (automatic)
   - **Auto-generated notes** from PRs and commits
   - **Version tag** from git tag or custom input

### Artifact Collection

The workflow automatically finds and downloads:
- All artifacts matching the `artifact_pattern`
- From the same commit SHA that triggered the release
- Generated by the specified `build_workflow`

---

## üì¶ Usage Patterns

### 1. Standard Firmware Release

```yaml
name: Firmware Release
on:
  push:
    tags: ['v[0-9]+.[0-9]+.[0-9]+']

jobs:
  build:
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1
    with:
      project_dir: examples/esp32

  release:
    needs: [build]
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-release-with-artifacts.yml@v1
    with:
      build_workflow: "esp32-examples-build-ci.yml"
    permissions:
      contents: write
```

### 2. Multi-Project Firmware

```yaml
jobs:
  build:
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1
    with:
      project_dir: examples/esp32

  release:
    needs: [build]
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-release-with-artifacts.yml@v1
    with:
      build_workflow: "esp32-examples-build-ci.yml"
      artifact_pattern: "fw-(basic|advanced)-.*"  # Multiple variants
    permissions:
      contents: write
```

### 3. Pre-release Testing

```yaml
jobs:
  release:
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-release-with-artifacts.yml@v1
    with:
      prerelease: true
      draft: ${{ github.event_name == 'workflow_dispatch' }}
      fail_on_no_artifacts: true  # Strict validation
    permissions:
      contents: write
```

### 4. Custom Build Workflow

```yaml
jobs:
  custom-build:
    name: "custom-esp32-ci.yml"  # Your custom workflow name
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1

  release:
    needs: [custom-build]
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-release-with-artifacts.yml@v1
    with:
      build_workflow: "custom-esp32-ci.yml"  # Match your workflow file
      artifact_pattern: "custom-fw-.*"       # Match your artifact names
```

---

## üèóÔ∏è Build Integration

### Required Build Setup

Your ESP32 build workflow must:

1. **Generate firmware artifacts** with consistent naming
2. **Upload artifacts** using `actions/upload-artifact`
3. **Use recognizable names** matching your `artifact_pattern`

Example ESP32 build that works with releases:

```yaml
# In your ESP32 build workflow
- name: Upload Firmware
  uses: actions/upload-artifact@v3
  with:
    name: fw-esp32c6-${{ matrix.app }}
    path: |
      examples/esp32/build/*.bin
      examples/esp32/build/*.elf
```

---

## üéØ Real-World Examples

### HardFOC Interface Release

```yaml
name: HardFOC Interface Release
on:
  push:
    tags: ['v*']

jobs:
  build:
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-build.yml@v1
    with:
      project_dir: examples/esp32
      project_tools_dir: hf-espidf-project-tools

  test:
    needs: [build]
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ci-security.yml@v1
    with:
      project_dir: examples/esp32

  release:
    needs: [build, test]
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-release-with-artifacts.yml@v1
    with:
      build_workflow: "esp32-examples-build-ci.yml"
      artifact_pattern: "fw-esp32c6-.*"
      fail_on_no_artifacts: true
    permissions:
      contents: write
```

---

## üõ†Ô∏è Advanced Configuration

### Dynamic Artifact Patterns

```yaml
# Use environment-based patterns
jobs:
  release:
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-release-with-artifacts.yml@v1
    with:
      artifact_pattern: ${{ github.ref_name == 'v*-beta*' && 'fw-beta-.*' || 'fw-.*' }}
```

### Conditional Releases

```yaml
jobs:
  release:
    if: startsWith(github.ref, 'refs/tags/') && !contains(github.ref_name, 'dev')
    uses: N3b3x/hf-espidf-ci-tools/.github/workflows/ru-release-with-artifacts.yml@v1
```

---

## üêõ Troubleshooting

### Common Issues

| Issue | Solution |
|-------|----------|
| **No artifacts found** | Check `build_workflow` name matches your workflow file exactly |
| **Wrong artifacts** | Verify `artifact_pattern` regex matches your artifact names |
| **Permission denied** | Add `permissions: contents: write` to calling workflow |
| **Build not found** | Ensure build workflow ran successfully on the same commit |

### Debug Steps

1. **Check build workflow** completed successfully
2. **Verify artifact names** in the Actions tab
3. **Test artifact pattern** with a regex tester
4. **Review permissions** in repository settings
5. **Use `fail_on_no_artifacts: true`** for strict validation

### Artifact Pattern Examples

```yaml
# Single project
artifact_pattern: "fw-esp32c6-myproject"

# Multiple ESP32 variants
artifact_pattern: "fw-esp32(c6|s3)-.*"

# All firmware artifacts
artifact_pattern: "fw-.*"

# Specific configurations
artifact_pattern: "fw-.*-(debug|release)"
```

---

## üîó Related Workflows

- **[ESP32 Build Workflow](build-workflow.md)** - Required for generating firmware artifacts
- **[Security Workflow](security-workflow.md)** - Often run before releases
- **[Basic Releases](https://github.com/n3b3x/hf-general-ci-tools)** - For projects without build artifacts

---

**üìñ [‚Üê Back to Documentation Index](index.md)**